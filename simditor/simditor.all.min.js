!function(){function t(t){return t.replace(/^\s+/g,"")}function e(t){return t.replace(/\s+$/g,"")}function i(i,n,r,o){function s(){return this.pos=0,this.token="",this.current_mode="CONTENT",this.tags={parent:"parent1",parentcount:1,parent1:""},this.tag_type="",this.token_text=this.last_token=this.last_text=this.token_type="",this.newlines=0,this.indent_content=l,this.Utils={whitespace:"\n\r	 ".split(""),single_token:"br,input,link,meta,source,!doctype,basefont,base,area,hr,wbr,param,img,isindex,embed".split(","),extra_liners:b,in_array:function(t,e){for(var i=0;i<e.length;i++)if(t===e[i])return!0;return!1}},this.is_whitespace=function(t){for(var e=0;e<t.length;t++)if(!this.Utils.in_array(t.charAt(e),this.Utils.whitespace))return!1;return!0},this.traverse_whitespace=function(){var t="";if(t=this.input.charAt(this.pos),this.Utils.in_array(t,this.Utils.whitespace)){for(this.newlines=0;this.Utils.in_array(t,this.Utils.whitespace);)f&&"\n"===t&&this.newlines<=g&&(this.newlines+=1),this.pos++,t=this.input.charAt(this.pos);return!0}return!1},this.space_or_wrap=function(t){this.line_char_count>=this.wrap_line_length?(this.print_newline(!1,t),this.print_indentation(t)):(this.line_char_count++,t.push(" "))},this.get_content=function(){for(var t="",e=[];"<"!==this.input.charAt(this.pos);){if(this.pos>=this.input.length)return e.length?e.join(""):["","TK_EOF"];if(this.traverse_whitespace())this.space_or_wrap(e);else{if(m){var i=this.input.substr(this.pos,3);if("{{#"===i||"{{/"===i)break;if("{{!"===i)return[this.get_tag(),"TK_TAG_HANDLEBARS_COMMENT"];if("{{"===this.input.substr(this.pos,2)&&"{{else}}"===this.get_tag(!0))break}t=this.input.charAt(this.pos),this.pos++,this.line_char_count++,e.push(t)}}return e.length?e.join(""):""},this.get_contents_to=function(t){if(this.pos===this.input.length)return["","TK_EOF"];var e="",i=new RegExp("</"+t+"\\s*>","igm");i.lastIndex=this.pos;var n=i.exec(this.input),r=n?n.index:this.input.length;return this.pos<r&&(e=this.input.substring(this.pos,r),this.pos=r),e},this.record_tag=function(t){this.tags[t+"count"]?(this.tags[t+"count"]++,this.tags[t+this.tags[t+"count"]]=this.indent_level):(this.tags[t+"count"]=1,this.tags[t+this.tags[t+"count"]]=this.indent_level),this.tags[t+this.tags[t+"count"]+"parent"]=this.tags.parent,this.tags.parent=t+this.tags[t+"count"]},this.retrieve_tag=function(t){if(this.tags[t+"count"]){for(var e=this.tags.parent;e&&t+this.tags[t+"count"]!==e;)e=this.tags[e+"parent"];e&&(this.indent_level=this.tags[t+this.tags[t+"count"]],this.tags.parent=this.tags[e+"parent"]),delete this.tags[t+this.tags[t+"count"]+"parent"],delete this.tags[t+this.tags[t+"count"]],1===this.tags[t+"count"]?delete this.tags[t+"count"]:this.tags[t+"count"]--}},this.indent_to_tag=function(t){if(this.tags[t+"count"]){for(var e=this.tags.parent;e&&t+this.tags[t+"count"]!==e;)e=this.tags[e+"parent"];e&&(this.indent_level=this.tags[t+this.tags[t+"count"]])}},this.get_tag=function(t){var e,i,n,r="",o=[],s="",a=!1,l=!0,u=this.pos,h=this.line_char_count;t=void 0!==t?t:!1;do{if(this.pos>=this.input.length)return t&&(this.pos=u,this.line_char_count=h),o.length?o.join(""):["","TK_EOF"];if(r=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(r,this.Utils.whitespace))a=!0;else{if(("'"===r||'"'===r)&&(r+=this.get_unformatted(r),a=!0),"="===r&&(a=!1),o.length&&"="!==o[o.length-1]&&">"!==r&&a){if(this.space_or_wrap(o),a=!1,!l&&"force"===v&&"/"!==r){this.print_newline(!0,o),this.print_indentation(o);for(var c=0;_>c;c++)o.push(d)}for(var f=0;f<o.length;f++)if(" "===o[f]){l=!1;break}}if(m&&"<"===n&&r+this.input.charAt(this.pos)==="{{"&&(r+=this.get_unformatted("}}"),o.length&&" "!==o[o.length-1]&&"<"!==o[o.length-1]&&(r=" "+r),a=!0),"<"!==r||n||(e=this.pos-1,n="<"),m&&!n&&o.length>=2&&"{"===o[o.length-1]&&"{"===o[o.length-2]&&(e="#"===r||"/"===r||"!"===r?this.pos-3:this.pos-2,n="{"),this.line_char_count++,o.push(r),o[1]&&("!"===o[1]||"?"===o[1]||"%"===o[1])){o=[this.get_comment(e)];break}if(m&&o[1]&&"{"===o[1]&&o[2]&&"!"===o[2]){o=[this.get_comment(e)];break}if(m&&"{"===n&&o.length>2&&"}"===o[o.length-2]&&"}"===o[o.length-1])break}}while(">"!==r);var g,y,b=o.join("");g=b.indexOf(-1!==b.indexOf(" ")?" ":"{"===b[0]?"}":">"),y="<"!==b[0]&&m?"#"===b[2]?3:2:1;var w=b.substring(y,g).toLowerCase();return"/"===b.charAt(b.length-2)||this.Utils.in_array(w,this.Utils.single_token)?t||(this.tag_type="SINGLE"):m&&"{"===b[0]&&"else"===w?t||(this.indent_to_tag("if"),this.tag_type="HANDLEBARS_ELSE",this.indent_content=!0,this.traverse_whitespace()):this.is_unformatted(w,p)?(s=this.get_unformatted("</"+w+">",b),o.push(s),i=this.pos-1,this.tag_type="SINGLE"):"script"===w&&(-1===b.search("type")||b.search("type")>-1&&b.search(/\b(text|application)\/(x-)?(javascript|ecmascript|jscript|livescript)/)>-1)?t||(this.record_tag(w),this.tag_type="SCRIPT"):"style"===w&&(-1===b.search("type")||b.search("type")>-1&&b.search("text/css")>-1)?t||(this.record_tag(w),this.tag_type="STYLE"):"!"===w.charAt(0)?t||(this.tag_type="SINGLE",this.traverse_whitespace()):t||("/"===w.charAt(0)?(this.retrieve_tag(w.substring(1)),this.tag_type="END"):(this.record_tag(w),"html"!==w.toLowerCase()&&(this.indent_content=!0),this.tag_type="START"),this.traverse_whitespace()&&this.space_or_wrap(o),this.Utils.in_array(w,this.Utils.extra_liners)&&(this.print_newline(!1,this.output),this.output.length&&"\n"!==this.output[this.output.length-2]&&this.print_newline(!0,this.output))),t&&(this.pos=u,this.line_char_count=h),o.join("")},this.get_comment=function(t){var e="",i=">",n=!1;for(this.pos=t,input_char=this.input.charAt(this.pos),this.pos++;this.pos<=this.input.length&&(e+=input_char,e[e.length-1]!==i[i.length-1]||-1===e.indexOf(i));)!n&&e.length<10&&(0===e.indexOf("<![if")?(i="<![endif]>",n=!0):0===e.indexOf("<![cdata[")?(i="]]>",n=!0):0===e.indexOf("<![")?(i="]>",n=!0):0===e.indexOf("<!--")?(i="-->",n=!0):0===e.indexOf("{{!")?(i="}}",n=!0):0===e.indexOf("<?")?(i="?>",n=!0):0===e.indexOf("<%")&&(i="%>",n=!0)),input_char=this.input.charAt(this.pos),this.pos++;return e},this.get_unformatted=function(t,e){if(e&&-1!==e.toLowerCase().indexOf(t))return"";var i="",n="",r=0,o=!0;do{if(this.pos>=this.input.length)return n;if(i=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(i,this.Utils.whitespace)){if(!o){this.line_char_count--;continue}if("\n"===i||"\r"===i){n+="\n",this.line_char_count=0;continue}}n+=i,this.line_char_count++,o=!0,m&&"{"===i&&n.length&&"{"===n[n.length-2]&&(n+=this.get_unformatted("}}"),r=n.length)}while(-1===n.toLowerCase().indexOf(t,r));return n},this.get_token=function(){var t;if("TK_TAG_SCRIPT"===this.last_token||"TK_TAG_STYLE"===this.last_token){var e=this.last_token.substr(7);return t=this.get_contents_to(e),"string"!=typeof t?t:[t,"TK_"+e]}if("CONTENT"===this.current_mode)return t=this.get_content(),"string"!=typeof t?t:[t,"TK_CONTENT"];if("TAG"===this.current_mode){if(t=this.get_tag(),"string"!=typeof t)return t;var i="TK_TAG_"+this.tag_type;return[t,i]}},this.get_full_indent=function(t){return t=this.indent_level+t||0,1>t?"":Array(t+1).join(this.indent_string)},this.is_unformatted=function(t,e){if(!this.Utils.in_array(t,e))return!1;if("a"!==t.toLowerCase()||!this.Utils.in_array("a",e))return!0;var i=this.get_tag(!0),n=(i||"").match(/^\s*<\s*\/?([a-z]*)\s*[^>]*>\s*$/);return!n||this.Utils.in_array(n,e)?!0:!1},this.printer=function(i,n,r,o,s){this.input=i||"",this.output=[],this.indent_character=n,this.indent_string="",this.indent_size=r,this.brace_style=s,this.indent_level=0,this.wrap_line_length=o,this.line_char_count=0;for(var a=0;a<this.indent_size;a++)this.indent_string+=this.indent_character;this.print_newline=function(t,i){this.line_char_count=0,i&&i.length&&(t||"\n"!==i[i.length-1])&&("\n"!==i[i.length-1]&&(i[i.length-1]=e(i[i.length-1])),i.push("\n"))},this.print_indentation=function(t){for(var e=0;e<this.indent_level;e++)t.push(this.indent_string),this.line_char_count+=this.indent_string.length},this.print_token=function(e){(!this.is_whitespace(e)||this.output.length)&&((e||""!==e)&&this.output.length&&"\n"===this.output[this.output.length-1]&&(this.print_indentation(this.output),e=t(e)),this.print_token_raw(e))},this.print_token_raw=function(t){this.newlines>0&&(t=e(t)),t&&""!==t&&(t.length>1&&"\n"===t[t.length-1]?(this.output.push(t.slice(0,-1)),this.print_newline(!1,this.output)):this.output.push(t));for(var i=0;i<this.newlines;i++)this.print_newline(i>0,this.output);this.newlines=0},this.indent=function(){this.indent_level++},this.unindent=function(){this.indent_level>0&&this.indent_level--}},this}var a,l,u,d,h,c,p,f,g,m,v,_,y,b;for(n=n||{},void 0!==n.wrap_line_length&&0!==parseInt(n.wrap_line_length,10)||void 0===n.max_char||0===parseInt(n.max_char,10)||(n.wrap_line_length=n.max_char),l=void 0===n.indent_inner_html?!1:n.indent_inner_html,u=void 0===n.indent_size?4:parseInt(n.indent_size,10),d=void 0===n.indent_char?" ":n.indent_char,c=void 0===n.brace_style?"collapse":n.brace_style,h=0===parseInt(n.wrap_line_length,10)?32786:parseInt(n.wrap_line_length||250,10),p=n.unformatted||["a","span","img","bdo","em","strong","dfn","code","samp","kbd","var","cite","abbr","acronym","q","sub","sup","tt","i","b","big","small","u","s","strike","font","ins","del","pre","address","dt","h1","h2","h3","h4","h5","h6"],f=void 0===n.preserve_newlines?!0:n.preserve_newlines,g=f?isNaN(parseInt(n.max_preserve_newlines,10))?32786:parseInt(n.max_preserve_newlines,10):0,m=void 0===n.indent_handlebars?!1:n.indent_handlebars,v=void 0===n.wrap_attributes?"auto":n.wrap_attributes,_=void 0===n.wrap_attributes_indent_size?u:parseInt(n.wrap_attributes_indent_size,10)||u,y=void 0===n.end_with_newline?!1:n.end_with_newline,b=Array.isArray(n.extra_liners)?n.extra_liners.concat():"string"==typeof n.extra_liners?n.extra_liners.split(","):"head,body,/html".split(","),n.indent_with_tabs&&(d="	",u=1),a=new s,a.printer(i,d,u,h,c);;){var w=a.get_token();if(a.token_text=w[0],a.token_type=w[1],"TK_EOF"===a.token_type)break;switch(a.token_type){case"TK_TAG_START":a.print_newline(!1,a.output),a.print_token(a.token_text),a.indent_content&&(a.indent(),a.indent_content=!1),a.current_mode="CONTENT";break;case"TK_TAG_STYLE":case"TK_TAG_SCRIPT":a.print_newline(!1,a.output),a.print_token(a.token_text),a.current_mode="CONTENT";break;case"TK_TAG_END":if("TK_CONTENT"===a.last_token&&""===a.last_text){var x=a.token_text.match(/\w+/)[0],T=null;a.output.length&&(T=a.output[a.output.length-1].match(/(?:<|{{#)\s*(\w+)/)),(null===T||T[1]!==x&&!a.Utils.in_array(T[1],p))&&a.print_newline(!1,a.output)}a.print_token(a.token_text),a.current_mode="CONTENT";break;case"TK_TAG_SINGLE":var k=a.token_text.match(/^\s*<([a-z-]+)/i);k&&a.Utils.in_array(k[1],p)||a.print_newline(!1,a.output),a.print_token(a.token_text),a.current_mode="CONTENT";break;case"TK_TAG_HANDLEBARS_ELSE":a.print_token(a.token_text),a.indent_content&&(a.indent(),a.indent_content=!1),a.current_mode="CONTENT";break;case"TK_TAG_HANDLEBARS_COMMENT":a.print_token(a.token_text),a.current_mode="TAG";break;case"TK_CONTENT":a.print_token(a.token_text),a.current_mode="TAG";break;case"TK_STYLE":case"TK_SCRIPT":if(""!==a.token_text){a.print_newline(!1,a.output);var C,$=a.token_text,A=1;"TK_SCRIPT"===a.token_type?C="function"==typeof r&&r:"TK_STYLE"===a.token_type&&(C="function"==typeof o&&o),"keep"===n.indent_scripts?A=0:"separate"===n.indent_scripts&&(A=-a.indent_level);var E=a.get_full_indent(A);if(C)$=C($.replace(/^\s*/,E),n);else{var N=$.match(/^\s*/)[0],B=N.match(/[^\n\r]*$/)[0].split(a.indent_string).length-1,R=a.get_full_indent(A-B);$=$.replace(/^\s*/,E).replace(/\r\n|\r|\n/g,"\n"+R).replace(/\s+$/,"")}$&&(a.print_token_raw($),a.print_newline(!0,a.output))}a.current_mode="TAG";break;default:""!==a.token_text&&a.print_token(a.token_text)}a.last_token=a.token_type,a.last_text=a.token_text}var S=a.output.join("").replace(/[\r\n\t ]+$/,"");return y&&(S+="\n"),S}if("function"==typeof define&&define.amd)define(["require","./beautify","./beautify-css"],function(t){var e=t("./beautify"),n=t("./beautify-css");return{html_beautify:function(t,r){return i(t,r,e.js_beautify,n.css_beautify)}}});else if("undefined"!=typeof exports){var n=require("./beautify.js"),r=require("./beautify-css.js");exports.html_beautify=function(t,e){return i(t,e,n.js_beautify,r.css_beautify)}}else"undefined"!=typeof window?window.html_beautify=function(t,e){return i(t,e,window.js_beautify,window.css_beautify)}:"undefined"!=typeof global&&(global.html_beautify=function(t,e){return i(t,e,global.js_beautify,global.css_beautify)})}(),function(){var t,e,i,n,r,o,s,a,l,u,d,h,c,p,f,g,m,v,_,y,b,w,x,T,k,C,A,E,N,B,R,S,M,O,I,z,F,U,H,L,K,j,D,P=[].slice,q=function(t,e){function i(){this.constructor=t}for(var n in e)W.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},W={}.hasOwnProperty,V=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};B=function(){function t(t){var e,i,n,r,o,s,a;if(this.opts=$.extend({},this.opts,t),(e=this.constructor)._connectedClasses||(e._connectedClasses=[]),r=function(){var t,e,n,r;for(n=this.constructor._connectedClasses,r=[],t=0,e=n.length;e>t;t++)i=n[t],a=i.pluginName.charAt(0).toLowerCase()+i.pluginName.slice(1),i.prototype._connected&&(i.prototype._module=this),r.push(this[a]=new i);return r}.call(this),this._connected)this.opts=$.extend({},this.opts,this._module.opts);else for(this._init(),o=0,s=r.length;s>o;o++)n=r[o],"function"==typeof n._init&&n._init();this.trigger("initialized")}return t.extend=function(t){var e,i,n;if(null!=t&&"object"==typeof t){for(e in t)n=t[e],"included"!==e&&"extended"!==e&&(this[e]=n);return null!=(i=t.extended)?i.call(this):void 0}},t.include=function(t){var e,i,n;if(null!=t&&"object"==typeof t){for(e in t)n=t[e],"included"!==e&&"extended"!==e&&(this.prototype[e]=n);return null!=(i=t.included)?i.call(this):void 0}},t.connect=function(t){if("function"==typeof t){if(!t.pluginName)throw new Error("Module.connect: cannot connect plugin without pluginName");return t.prototype._connected=!0,this._connectedClasses||(this._connectedClasses=[]),this._connectedClasses.push(t),t.pluginName?this[t.pluginName]=t:void 0}},t.prototype.opts={},t.prototype._init=function(){},t.prototype.on=function(){var t,e;return t=1<=arguments.length?P.call(arguments,0):[],(e=$(this)).on.apply(e,t),this},t.prototype.one=function(){var t,e;return t=1<=arguments.length?P.call(arguments,0):[],(e=$(this)).one.apply(e,t),this},t.prototype.off=function(){var t,e;return t=1<=arguments.length?P.call(arguments,0):[],(e=$(this)).off.apply(e,t),this},t.prototype.trigger=function(){var t,e;return t=1<=arguments.length?P.call(arguments,0):[],(e=$(this)).trigger.apply(e,t),this},t.prototype.triggerHandler=function(){var t,e;return t=1<=arguments.length?P.call(arguments,0):[],(e=$(this)).triggerHandler.apply(e,t)},t.prototype._t=function(){var t,e;return t=1<=arguments.length?P.call(arguments,0):[],(e=this.constructor)._t.apply(e,t)},t._t=function(){var t,e,i,n;return e=arguments[0],t=2<=arguments.length?P.call(arguments,1):[],n=(null!=(i=this.i18n[this.locale])?i[e]:void 0)||"",t.length>0?(n=n.replace(/([^%]|^)%(?:(\d+)\$)?s/g,function(e,i,n){return n?i+t[parseInt(n)-1]:i+t.shift()}),n.replace(/%%s/g,"%s")):n},t.i18n={"zh-CN":{}},t.locale="zh-CN",t}(),U=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.count=0,e.prototype.opts={url:"",params:null,fileKey:"upload_file",connectionCount:3},e.prototype._init=function(){return this.files=[],this.queue=[],this.id=++e.count,this.on("uploadcomplete",function(t){return function(e,i){return t.files.splice($.inArray(i,t.files),1),t.queue.length>0&&t.files.length<t.opts.connectionCount?t.upload(t.queue.shift()):t.uploading=!1}}(this)),$(window).on("beforeunload.uploader-"+this.id,function(t){return function(e){return t.uploading?(e.originalEvent.returnValue=t._t("leaveConfirm"),t._t("leaveConfirm")):void 0}}(this))},e.prototype.generateId=function(){var t;return t=0,function(){return t+=1}}(),e.prototype.upload=function(t,e){var i,n,r,o;if(null==e&&(e={}),null!=t){if($.isArray(t)||t instanceof FileList)for(n=0,o=t.length;o>n;n++)i=t[n],this.upload(i,e);else $(t).is("input:file")?(r=$(t).attr("name"),r&&(e.fileKey=r),this.upload($.makeArray($(t)[0].files),e)):t.id&&t.obj||(t=this.getFile(t));if(t&&t.obj){if($.extend(t,e),this.files.length>=this.opts.connectionCount)return void this.queue.push(t);if(this.triggerHandler("beforeupload",[t])!==!1)return this.files.push(t),this._xhrUpload(t),this.uploading=!0}}},e.prototype.getFile=function(t){var e,i,n;return t instanceof window.File||t instanceof window.Blob?(e=null!=(i=t.fileName)?i:t.name,{id:this.generateId(),url:this.opts.url,params:this.opts.params,fileKey:this.opts.fileKey,name:e,size:null!=(n=t.fileSize)?n:t.size,ext:e?e.split(".").pop().toLowerCase():"",obj:t}):null},e.prototype._xhrUpload=function(t){var e,i,n,r;if(e=new FormData,e.append(t.fileKey,t.obj),e.append("original_filename",t.name),t.params){n=t.params;for(i in n)r=n[i],e.append(i,r)}return t.xhr=$.ajax({url:t.url,data:e,processData:!1,contentType:!1,type:"POST",headers:{"X-File-Name":encodeURIComponent(t.name)},xhr:function(){var t;return t=$.ajaxSettings.xhr(),t&&(t.upload.onprogress=function(t){return function(e){return t.progress(e)}}(this)),t},progress:function(e){return function(i){return i.lengthComputable?e.trigger("uploadprogress",[t,i.loaded,i.total]):void 0}}(this),error:function(e){return function(i,n,r){return e.trigger("uploaderror",[t,i,n])}}(this),success:function(e){return function(i){return e.trigger("uploadprogress",[t,t.size,t.size]),e.trigger("uploadsuccess",[t,i]),$(document).trigger("uploadsuccess",[t,i,e])}}(this),complete:function(e){return function(i,n){return e.trigger("uploadcomplete",[t,i.responseText])}}(this)})},e.prototype.cancel=function(t){var e,i,n,r;if(!t.id)for(r=this.files,i=0,n=r.length;n>i;i++)if(e=r[i],e.id===1*t){t=e;break}return this.trigger("uploadcancel",[t]),t.xhr&&t.xhr.abort(),t.xhr=null},e.prototype.readImageFile=function(t,e){var i,n;if($.isFunction(e))return n=new Image,n.onload=function(){return e(n)},n.onerror=function(){return e()},window.FileReader&&FileReader.prototype.readAsDataURL&&/^image/.test(t.type)?(i=new FileReader,i.onload=function(t){return n.src=t.target.result},i.readAsDataURL(t)):e()},e.prototype.destroy=function(){var t,e,i,n;for(this.queue.length=0,n=this.files,e=0,i=n.length;i>e;e++)t=n[e],this.cancel(t);return $(window).off(".uploader-"+this.id),$(document).off(".uploader-"+this.id)},e.i18n={"zh-CN":{leaveConfirm:"正在上传文件，如果离开上传会自动取消"}},e.locale="zh-CN",e}(B),D=function(t){return new U(t)},j=function(t){var e,i;return e=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.count=0,e.keyNameMap={8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",91:"Meta",93:"Meta",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"A",66:"B",67:"C",68:"D",69:"E",70:"F",71:"G",72:"H",73:"I",74:"J",75:"K",76:"L",77:"M",78:"N",79:"O",80:"P",81:"Q",82:"R",83:"S",84:"T",85:"U",86:"V",87:"W",88:"X",89:"Y",90:"Z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"Multiply",107:"Add",109:"Subtract",110:"Decimal",111:"Divide",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",124:"F13",125:"F14",126:"F15",127:"F16",128:"F17",129:"F18",130:"F19",131:"F20",132:"F21",133:"F22",134:"F23",135:"F24",59:";",61:"=",186:";",187:"=",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},e.aliases={escape:"esc","delete":"del","return":"enter",ctrl:"control",space:"spacebar",ins:"insert",cmd:"meta",command:"meta",wins:"meta",windows:"meta"},e.normalize=function(t){var e,i,n,r,o,s;for(o=t.toLowerCase().replace(/\s+/gi,"").split("+"),e=i=0,s=o.length;s>i;e=++i)n=o[e],o[e]=this.aliases[n]||n;return r=o.pop(),o.sort().push(r),o.join("_")},e.prototype.opts={el:document},e.prototype._init=function(){return this.id=++this.constructor.count,this._map={},this._delegate="string"==typeof this.opts.el?document:this.opts.el,$(this._delegate).on("keydown.simple-hotkeys-"+this.id,this.opts.el,function(t){return function(e){var i;return null!=(i=t._getHander(e))?i.call(t,e):void 0}}(this))},e.prototype._getHander=function(t){var e,i;if(e=this.constructor.keyNameMap[t.which])return i="",t.altKey&&(i+="alt_"),t.ctrlKey&&(i+="control_"),t.metaKey&&(i+="meta_"),t.shiftKey&&(i+="shift_"),i+=e.toLowerCase(),this._map[i]},e.prototype.respondTo=function(t){return"string"==typeof t?null!=this._map[this.constructor.normalize(t)]:null!=this._getHander(t)},e.prototype.add=function(t,e){return this._map[this.constructor.normalize(t)]=e,this},e.prototype.remove=function(t){return delete this._map[this.constructor.normalize(t)],this},e.prototype.destroy=function(){return $(this._delegate).off(".simple-hotkeys-"+this.id),this._map={},this},e}(t),i=function(t){return new e(t)}}(B),E=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.pluginName="Selection",e.prototype._init=function(){return this.editor=this._module,this.sel=document.getSelection()},e.prototype.clear=function(){var t;try{return this.sel.removeAllRanges()}catch(e){t=e}},e.prototype.getRange=function(){return this.editor.inputManager.focused&&this.sel.rangeCount?this.sel.getRangeAt(0):null},e.prototype.selectRange=function(t){return this.clear(),this.sel.addRange(t),this.editor.inputManager.focused||!this.editor.util.browser.firefox&&!this.editor.util.browser.msie||this.editor.body.focus(),t},e.prototype.rangeAtEndOf=function(t,e){var i,n,r;return null==e&&(e=this.getRange()),null!=e&&e.collapsed?(t=$(t)[0],i=e.endContainer,n=this.editor.util.getNodeLength(i),e.endOffset===n-1&&$(i).contents().last().is("br")||e.endOffset===n?t===i?!0:$.contains(t,i)?(r=!0,$(i).parentsUntil(t).addBack().each(function(t){return function(t,e){var i,n;return n=$(e).parent().contents().filter(function(){return!(this!==e&&3===this.nodeType&&!this.nodeValue)}),i=n.last(),i.get(0)===e||i.is("br")&&i.prev().get(0)===e?void 0:(r=!1,!1)}}(this)),r):!1:!1):void 0},e.prototype.rangeAtStartOf=function(t,e){var i,n;return null==e&&(e=this.getRange()),null!=e&&e.collapsed?(t=$(t)[0],n=e.startContainer,0!==e.startOffset?!1:t===n?!0:$.contains(t,n)?(i=!0,$(n).parentsUntil(t).addBack().each(function(t){return function(t,e){var n;return n=$(e).parent().contents().filter(function(){return!(this!==e&&3===this.nodeType&&!this.nodeValue)}),n.first().get(0)!==e?i=!1:void 0}}(this)),i):!1):void 0},e.prototype.insertNode=function(t,e){return null==e&&(e=this.getRange()),null!=e?(t=$(t)[0],e.insertNode(t),this.setRangeAfter(t,e)):void 0},e.prototype.setRangeAfter=function(t,e){return null==e&&(e=this.getRange()),null!=e?(t=$(t)[0],e.setEndAfter(t),e.collapse(!1),this.selectRange(e)):void 0},e.prototype.setRangeBefore=function(t,e){return null==e&&(e=this.getRange()),null!=e?(t=$(t)[0],e.setEndBefore(t),e.collapse(!1),this.selectRange(e)):void 0},e.prototype.setRangeAtStartOf=function(t,e){return null==e&&(e=this.getRange()),t=$(t).get(0),e.setEnd(t,0),e.collapse(!1),this.selectRange(e)},e.prototype.setRangeAtEndOf=function(t,e){var i,n,r,o,s,a;return null==e&&(e=this.getRange()),n=$(t),t=n.get(0),n.is("pre")?(r=n.contents(),r.length>0?(o=r.last(),s=o.text(),"\n"===s.charAt(s.length-1)?e.setEnd(o[0],this.editor.util.getNodeLength(o[0])-1):e.setEnd(o[0],this.editor.util.getNodeLength(o[0]))):e.setEnd(t,0)):(a=this.editor.util.getNodeLength(t),3!==t.nodeType&&a>0&&(i=$(t).contents().last(),i.is("br")?a-=1:3!==i[0].nodeType&&this.editor.util.isEmptyNode(i)&&(i.append(this.editor.util.phBr),t=i[0],a=0)),e.setEnd(t,a)),e.collapse(!1),this.selectRange(e)},e.prototype.deleteRangeContents=function(t){var e,i;return null==t&&(t=this.getRange()),i=t.cloneRange(),e=t.cloneRange(),i.collapse(!0),e.collapse(!1),!t.collapsed&&this.rangeAtStartOf(this.editor.body,i)&&this.rangeAtEndOf(this.editor.body,e)?(this.editor.body.empty(),t.setStart(this.editor.body[0],0),t.collapse(!0),this.selectRange(t)):t.deleteContents(),t},e.prototype.breakBlockEl=function(t,e){var i;return null==e&&(e=this.getRange()),i=$(t),e.collapsed?(e.setStartBefore(i.get(0)),e.collapsed?i:i.before(e.extractContents())):i},e.prototype.save=function(t){var e,i,n;return null==t&&(t=this.getRange()),this._selectionSaved?void 0:(i=t.cloneRange(),i.collapse(!1),n=$("<span/>").addClass("simditor-caret-start"),e=$("<span/>").addClass("simditor-caret-end"),i.insertNode(e[0]),t.insertNode(n[0]),this.clear(),this._selectionSaved=!0)},e.prototype.restore=function(){var t,e,i,n,r,o,s;return this._selectionSaved?(r=this.editor.body.find(".simditor-caret-start"),t=this.editor.body.find(".simditor-caret-end"),r.length&&t.length?(o=r.parent(),s=o.contents().index(r),e=t.parent(),i=e.contents().index(t),o[0]===e[0]&&(i-=1),n=document.createRange(),n.setStart(o.get(0),s),n.setEnd(e.get(0),i),r.remove(),t.remove(),this.selectRange(n)):(r.remove(),t.remove()),this._selectionSaved=!1,n):!1},e}(B),l=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.pluginName="Formatter",e.prototype.opts={allowedTags:null,allowedAttributes:null},e.prototype._init=function(){return this.editor=this._module,this._allowedTags=this.opts.allowedTags||["br","a","img","b","strong","i","u","font","p","ul","ol","li","blockquote","pre","code","h1","h2","h3","h4","hr"],this._allowedAttributes=this.opts.allowedAttributes||{img:["src","alt","width","height","data-image-src","data-image-size","data-image-name","data-non-image"],a:["href","target"],font:["color"],pre:["data-lang"],code:["class"],p:["data-indent","data-align"],h1:["data-indent"],h2:["data-indent"],h3:["data-indent"],h4:["data-indent"]},this.editor.body.on("click","a",function(t){return function(t){return!1}}(this))},e.prototype.decorate=function(t){return null==t&&(t=this.editor.body),this.editor.trigger("decorate",[t])},e.prototype.undecorate=function(t){return null==t&&(t=this.editor.body.clone()),this.editor.trigger("undecorate",[t]),$.trim(t.html())},e.prototype.autolink=function(t){var e,i,n,r,o,s,a,l,u,d,h;for(null==t&&(t=this.editor.body),s=[],i=function(e){return e.contents().each(function(e,n){var r,o;return r=$(n),r.is("a")||r.closest("a, pre",t).length||r.is("iframe")?void 0:r.contents().length?i(r):(o=r.text())&&/https?:\/\/|www\./gi.test(o)?s.push(r):void 0})},i(t),l=/(https?:\/\/|www\.)[\w\-\.\?&=\/#%:,@\!\+]+/gi,n=0,o=s.length;o>n;n++){for(e=s[n],d=e.text(),u=[],a=null,r=0;null!==(a=l.exec(d));)u.push(document.createTextNode(d.substring(r,a.index))),r=l.lastIndex,h=/^(http(s)?:\/\/|\/)/.test(a[0])?a[0]:"http://"+a[0],u.push($('<a href="'+h+'" rel="nofollow"></a>').text(a[0])[0]);u.push(document.createTextNode(d.substring(r))),e.replaceWith($(u))}return t},e.prototype.format=function(t){var e,i,n,r,o,s,a,l,u,d;if(null==t&&(t=this.editor.body),t.is(":empty"))return t.append("<p>"+this.editor.util.phBr+"</p>"),t;for(u=t.contents(),n=0,o=u.length;o>n;n++)a=u[n],this.cleanNode(a,!0);for(d=t.contents(),r=0,s=d.length;s>r;r++){if(l=d[r],e=$(l),e.is("iframe"))return;e.is("br")?("undefined"!=typeof i&&null!==i&&(i=null),e.remove()):this.editor.util.isBlockNode(l)?e.is("li")?i&&i.is("ul, ol")?i.append(l):(i=$("<ul/>").insertBefore(l),i.append(l)):i=null:((!i||i.is("ul, ol"))&&(i=$("<p/>").insertBefore(l)),i.append(l))}return t},e.prototype.cleanNode=function(t,e){var i,n,r,o,s,a,l,u,d,h,c,p,f,g,m,v,_;if(n=$(t),!n.is("iframe")&&n.length>0){if(3===n[0].nodeType)return v=n.text().replace(/(\r\n|\n|\r)/gm,""),void(v?(_=document.createTextNode(v),n.replaceWith(_)):n.remove());if(l=n.contents(),u=n.is('[class^="simditor-"]'),n.is(this._allowedTags.join(","))||u){if(n.is("a")&&(i=n.find("img")).length>0&&(n.replaceWith(i),n=i,l=null),n.is("img")&&n.hasClass("uploading")&&n.remove(),!u)for(s=this._allowedAttributes[n[0].tagName.toLowerCase()],g=$.makeArray(n[0].attributes),d=0,c=g.length;c>d;d++)a=g[d],null!=s&&(m=a.name,V.call(s,m)>=0)||n.removeAttr(a.name)}else 1!==n[0].nodeType||n.is(":empty")?(n.remove(),l=null):n.is("div, article, dl, header, footer, tr")?(n.append("<br/>"),l.first().unwrap()):n.is("table")?(r=$("<p/>"),n.find("tr").each(function(t){return function(t,e){return r.append($(e).text()+"<br/>")}}(this)),n.replaceWith(r),l=null):n.is("thead, tfoot")?(n.remove(),l=null):n.is("th")?(o=$("<td/>").append(n.contents()),n.replaceWith(o)):l.first().unwrap();if(e&&null!=l&&!n.is("pre")&&!n.is("iframe"))for(h=0,p=l.length;p>h;h++)f=l[h],this.cleanNode(f,!0);return null}},e.prototype.clearHtml=function(t,e){var i,n,r;return null==e&&(e=!0),i=$("<div/>").append(t),n=i.contents(),r="",n.each(function(t){return function(i,o){var s,a;return 3===o.nodeType?r+=o.nodeValue:1===o.nodeType&&(s=$(o),a=s.contents(),a.length>0&&(r+=t.clearHtml(a)),e&&i<n.length-1&&s.is("br, p, div, li, tr, pre, address, artticle, aside, dl, figcaption, footer, h1, h2, h3, h4, header"))?r+="\n":void 0}}(this)),r},e.prototype.beautify=function(t){var e;return e=function(t){return!!(t.is("p")&&!t.text()&&t.children(":not(br)").length<1)},t.each(function(t){return function(t,i){var n;return n=$(i),n.is(':not(img, br, col, td, hr, [class^="simditor-"]):empty')&&n.remove(),e(n)&&n.remove(),n.find(':not(img, br, col, td, hr, [class^="simditor-"]):empty').remove()}}(this))},e}(B),m=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.pluginName="InputManager",e.prototype.opts={pasteImage:!1},e.prototype._modifierKeys=[16,17,18,91,93,224],e.prototype._arrowKeys=[37,38,39,40],e.prototype._init=function(){var t;return this.editor=this._module,this.throttledTrigger=this.editor.util.throttle(function(t){return function(){var e;return e=1<=arguments.length?P.call(arguments,0):[],setTimeout(function(){var i;return(i=t.editor).trigger.apply(i,e)},10)}}(this),300),this.opts.pasteImage&&"string"!=typeof this.opts.pasteImage&&(this.opts.pasteImage="inline"),this._keystrokeHandlers={},this.hotkeys=j({el:this.editor.body}),this._pasteArea=$("<div/>").css({width:"1px",height:"1px",overflow:"hidden",position:"fixed",right:"0",bottom:"100px"}).attr({tabIndex:"-1",contentEditable:!0}).addClass("simditor-paste-area").appendTo(this.editor.el),$(document).on("selectionchange.simditor"+this.editor.id,function(t){return function(e){return t.focused?(t._selectionTimer&&(clearTimeout(t._selectionTimer),t._selectionTimer=null),t._selectionTimer=setTimeout(function(){return t.editor.trigger("selectionchanged")},20)):void 0}}(this)),this.editor.on("valuechanged",function(t){return function(){return!t.editor.util.closestBlockEl()&&t.focused&&(t.editor.selection.save(),t.editor.formatter.format(),t.editor.selection.restore()),t.editor.body.find("hr, pre, .simditor-table").each(function(e,i){var n,r;return n=$(i),(n.parent().is("blockquote")||n.parent()[0]===t.editor.body[0])&&(r=!1,0===n.next().length&&($("<p/>").append(t.editor.util.phBr).insertAfter(n),r=!0),0===n.prev().length&&($("<p/>").append(t.editor.util.phBr).insertBefore(n),r=!0),r)?setTimeout(function(){return t.editor.trigger("valuechanged")},10):void 0}),t.editor.body.find("pre:empty").append(t.editor.util.phBr),!t.editor.util.support.onselectionchange&&t.focused?t.editor.trigger("selectionchanged"):void 0}}(this)),this.editor.on("selectionchanged",function(t){return function(e){return t.editor.undoManager.update()}}(this)),this.editor.body.on("keydown",$.proxy(this._onKeyDown,this)).on("keypress",$.proxy(this._onKeyPress,this)).on("keyup",$.proxy(this._onKeyUp,this)).on("mouseup",$.proxy(this._onMouseUp,this)).on("focus",$.proxy(this._onFocus,this)).on("blur",$.proxy(this._onBlur,this)).on("paste",$.proxy(this._onPaste,this)).on("drop",$.proxy(this._onDrop,this)).on("input",$.proxy(this._onInput,this)),
this.editor.util.browser.firefox&&(this.addShortcut("cmd+left",function(t){return function(e){return e.preventDefault(),t.editor.selection.sel.modify("move","backward","lineboundary"),!1}}(this)),this.addShortcut("cmd+right",function(t){return function(e){return e.preventDefault(),t.editor.selection.sel.modify("move","forward","lineboundary"),!1}}(this)),this.addShortcut(this.editor.util.os.mac?"cmd+a":"ctrl+a",function(t){return function(e){var i,n,r,o;return i=t.editor.body.children(),i.length>0?(n=i.first().get(0),r=i.last().get(0),o=document.createRange(),o.setStart(n,0),o.setEnd(r,t.editor.util.getNodeLength(r)),t.editor.selection.selectRange(o),!1):void 0}}(this))),t=this.editor.util.os.mac?"cmd+enter":"ctrl+enter",this.addShortcut(t,function(t){return function(e){return t.editor.el.closest("form").find("button:submit").click(),!1}}(this)),this.editor.textarea.attr("autofocus")?setTimeout(function(t){return function(){return t.editor.focus()}}(this),0):void 0},e.prototype._onFocus=function(t){return this.editor.el.addClass("focus").removeClass("error"),this.focused=!0,this.lastCaretPosition=null,setTimeout(function(t){return function(){return t.editor.triggerHandler("focus"),t.editor.trigger("selectionchanged")}}(this),0)},e.prototype._onBlur=function(t){var e;return this.editor.el.removeClass("focus"),this.editor.sync(),this.focused=!1,this.lastCaretPosition=null!=(e=this.editor.undoManager.currentState())?e.caret:void 0,this.editor.triggerHandler("blur")},e.prototype._onMouseUp=function(t){return this.editor.util.support.onselectionchange?void 0:setTimeout(function(t){return function(){return t.editor.trigger("selectionchanged")}}(this),0)},e.prototype._onKeyDown=function(t){var e,i,n,r;if(this.editor.triggerHandler(t)===!1)return!1;if(!this.hotkeys.respondTo(t)){if(t.which in this._keystrokeHandlers){if(r="function"==typeof(e=this._keystrokeHandlers[t.which])["*"]?e["*"](t):void 0)return this.editor.trigger("valuechanged"),!1;if(this.editor.util.traverseUp(function(e){return function(i){var n,o;if(i.nodeType===document.ELEMENT_NODE)return n=null!=(o=e._keystrokeHandlers[t.which])?o[i.tagName.toLowerCase()]:void 0,r="function"==typeof n?n(t,$(i)):void 0,r===!0||r===!1?!1:void 0}}(this)),r)return this.editor.trigger("valuechanged"),!1}if(i=t.which,!(V.call(this._modifierKeys,i)>=0||(n=t.which,V.call(this._arrowKeys,n)>=0)||this.editor.util.metaKey(t)&&86===t.which))return this.editor.util.support.oninput||this.throttledTrigger("valuechanged",["typing"]),null}},e.prototype._onKeyPress=function(t){return this.editor.triggerHandler(t)===!1?!1:void 0},e.prototype._onKeyUp=function(t){var e,i;return this.editor.triggerHandler(t)===!1?!1:!this.editor.util.support.onselectionchange&&(i=t.which,V.call(this._arrowKeys,i)>=0)?void this.editor.trigger("selectionchanged"):void(8!==t.which&&46!==t.which||!this.editor.util.isEmptyNode(this.editor.body)||(this.editor.body.empty(),e=$("<p/>").append(this.editor.util.phBr).appendTo(this.editor.body),this.editor.selection.setRangeAtStartOf(e)))},e.prototype._onPaste=function(t){var e,i,n,r,o,s,a,l,u;if(this.editor.triggerHandler(t)===!1)return!1;if(a=this.editor.selection.deleteRangeContents(),a.collapsed||a.collapse(!0),e=this.editor.util.closestBlockEl(),i=e.is("pre, table"),t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items&&t.originalEvent.clipboardData.items.length>0&&(o=t.originalEvent.clipboardData.items[0],/^image\//.test(o.type)&&!i)){if(n=o.getAsFile(),null==n||!this.opts.pasteImage)return;return n.name||(n.name="Clipboard Image.png"),u={},u[this.opts.pasteImage]=!0,null!=(l=this.editor.uploader)&&l.upload(n,u),!1}return s=function(t){return function(n){var r,o,s,l,d,h,c,p,f,g,m,v,_,y,b,w,x,T,k,C,A;if(t.editor.triggerHandler("pasting",[n])!==!1&&n){if(i)if(e.is("table")){for(y=n.split("\n"),c=y.pop(),d=0,p=y.length;p>d;d++)_=y[d],t.editor.selection.insertNode(document.createTextNode(_)),t.editor.selection.insertNode($("<br/>"));t.editor.selection.insertNode(document.createTextNode(c))}else for(n=$("<div/>").text(n),k=n.contents(),h=0,f=k.length;f>h;h++)w=k[h],t.editor.selection.insertNode($(w)[0],a);else if(e.is(t.editor.body))for(b=0,g=n.length;g>b;b++)w=n[b],t.editor.selection.insertNode(w,a);else{if(n.length<1)return;if(1===n.length)if(n.is("p")){if(s=n.contents(),1===s.length&&s.is("img")){if(r=s,/^data:image/.test(r.attr("src"))){if(!t.opts.pasteImage)return;return o=t.editor.util.dataURLtoBlob(r.attr("src")),o.name="Clipboard Image.png",u={},u[t.opts.pasteImage]=!0,void(null!=(C=t.editor.uploader)&&C.upload(o,u))}if(r.is('img[src^="webkit-fake-url://"]'))return}for(x=0,m=s.length;m>x;x++)w=s[x],t.editor.selection.insertNode(w,a)}else if(e.is("p")&&t.editor.util.isEmptyNode(e))e.replaceWith(n),t.editor.selection.setRangeAtEndOf(n,a);else if(n.is("ul, ol"))if(1===n.find("li").length)for(n=$("<div/>").text(n.text()),A=n.contents(),T=0,v=A.length;v>T;T++)w=A[T],t.editor.selection.insertNode($(w)[0],a);else e.is("li")?(e.parent().after(n),t.editor.selection.setRangeAtEndOf(n,a)):(e.after(n),t.editor.selection.setRangeAtEndOf(n,a));else e.after(n),t.editor.selection.setRangeAtEndOf(n,a);else e.is("li")&&(e=e.parent()),t.editor.selection.rangeAtStartOf(e,a)?l="before":t.editor.selection.rangeAtEndOf(e,a)?l="after":(t.editor.selection.breakBlockEl(e,a),l="before"),e[l](n),t.editor.selection.setRangeAtEndOf(n.last(),a)}return t.editor.trigger("valuechanged")}}}(this),i?(t.preventDefault(),r=this.editor.util.browser.msie?window.clipboardData.getData("Text"):t.originalEvent.clipboardData.getData("text/plain"),s(r)):(this.editor.selection.save(a),this._pasteArea.focus(),this.editor.util.browser.msie&&10===this.editor.util.browser.version&&(t.preventDefault(),this._pasteArea.html(window.clipboardData.getData("Text"))),setTimeout(function(t){return function(){return t._pasteArea.is(":empty")?r=null:(r=$("<div/>").append(t._pasteArea.contents()),r.find("table colgroup").remove(),t.editor.formatter.format(r),t.editor.formatter.decorate(r),t.editor.formatter.beautify(r.children()),r=r.contents()),t._pasteArea.empty(),a=t.editor.selection.restore(),s(r)}}(this),10))},e.prototype._onDrop=function(t){return this.editor.triggerHandler(t)===!1?!1:setTimeout(function(t){return function(){return t.editor.trigger("valuechanged")}}(this),0)},e.prototype._onInput=function(t){return this.throttledTrigger("valuechanged",["oninput"])},e.prototype.addKeystrokeHandler=function(t,e,i){return this._keystrokeHandlers[t]||(this._keystrokeHandlers[t]={}),this._keystrokeHandlers[t][e]=i},e.prototype.addShortcut=function(t,e){return this.hotkeys.add(t,$.proxy(e,this))},e}(B),_=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.pluginName="Keystroke",e.prototype._init=function(){var t;return this.editor=this._module,this.editor.util.browser.safari&&this.editor.inputManager.addKeystrokeHandler("13","*",function(t){return function(e){var i,n;if(e.shiftKey&&(i=t.editor.util.closestBlockEl(),!i.is("pre")))return n=$("<br/>"),t.editor.selection.rangeAtEndOf(i)?(t.editor.selection.insertNode(n),t.editor.selection.insertNode($("<br/>")),t.editor.selection.setRangeBefore(n)):t.editor.selection.insertNode(n),!0}}(this)),(this.editor.util.browser.webkit||this.editor.util.browser.msie)&&(t=function(t){return function(e,i){var n;if(t.editor.selection.rangeAtEndOf(i))return n=$("<p/>").append(t.editor.util.phBr).insertAfter(i),t.editor.selection.setRangeAtStartOf(n),!0}}(this),this.editor.inputManager.addKeystrokeHandler("13","h1",t),this.editor.inputManager.addKeystrokeHandler("13","h2",t),this.editor.inputManager.addKeystrokeHandler("13","h3",t),this.editor.inputManager.addKeystrokeHandler("13","h4",t),this.editor.inputManager.addKeystrokeHandler("13","h5",t),this.editor.inputManager.addKeystrokeHandler("13","h6",t)),this.editor.inputManager.addKeystrokeHandler("8","*",function(t){return function(e){var i,n,r;return r=t.editor.util.furthestBlockEl(),n=r.prev(),n.is("hr")&&t.editor.selection.rangeAtStartOf(r)?(t.editor.selection.save(),n.remove(),t.editor.selection.restore(),!0):(i=t.editor.util.closestBlockEl(),t.editor.util.browser.webkit&&t.editor.selection.rangeAtStartOf(i)?(t.editor.selection.save(),t.editor.formatter.cleanNode(i,!0),t.editor.selection.restore(),null):void 0)}}(this)),this.editor.inputManager.addKeystrokeHandler("13","li",function(t){return function(e,i){var n,r,o,s;if(n=i.clone(),n.find("ul, ol").remove(),t.editor.util.isEmptyNode(n)&&i.is(t.editor.util.closestBlockEl())){if(r=i.parent(),i.next("li").length>0){if(!t.editor.util.isEmptyNode(i))return;r.parent("li").length>0?(o=$("<li/>").append(t.editor.util.phBr).insertAfter(r.parent("li")),s=$("<"+r[0].tagName+"/>").append(i.nextAll("li")),o.append(s)):(o=$("<p/>").append(t.editor.util.phBr).insertAfter(r),s=$("<"+r[0].tagName+"/>").append(i.nextAll("li")),o.after(s))}else r.parent("li").length>0?(o=$("<li/>").insertAfter(r.parent("li")),o.append(i.contents().length>0?i.contents():t.editor.util.phBr)):(o=$("<p/>").append(t.editor.util.phBr).insertAfter(r),i.children("ul, ol").length>0&&o.after(i.children("ul, ol")));return i.prev("li").length?i.remove():r.remove(),t.editor.selection.setRangeAtStartOf(o),!0}}}(this)),this.editor.inputManager.addKeystrokeHandler("13","pre",function(t){return function(e,i){var n,r,o;return e.preventDefault(),e.shiftKey?(n=$("<p/>").append(t.editor.util.phBr).insertAfter(i),t.editor.selection.setRangeAtStartOf(n),!0):(o=t.editor.selection.getRange(),r=null,o.deleteContents(),!t.editor.util.browser.msie&&t.editor.selection.rangeAtEndOf(i)?(r=document.createTextNode("\n\n"),o.insertNode(r),o.setEnd(r,1)):(r=document.createTextNode("\n"),o.insertNode(r),o.setStartAfter(r)),o.collapse(!1),t.editor.selection.selectRange(o),!0)}}(this)),this.editor.inputManager.addKeystrokeHandler("13","blockquote",function(t){return function(e,i){var n,r;return n=t.editor.util.closestBlockEl(),n.is("p")&&!n.next().length&&t.editor.util.isEmptyNode(n)?(i.after(n),r=document.createRange(),t.editor.selection.setRangeAtStartOf(n,r),!0):void 0}}(this)),this.editor.inputManager.addKeystrokeHandler("8","li",function(t){return function(e,i){var n,r,o,s,a,l,u,d;return r=i.children("ul, ol"),a=i.prev("li"),r.length>0&&a.length>0?(d="",l=null,i.contents().each(function(t,e){if(1===e.nodeType&&/UL|OL/.test(e.nodeName))return!1;if(1!==e.nodeType||!/BR/.test(e.nodeName))return 3===e.nodeType&&e.nodeValue?d+=e.nodeValue:1===e.nodeType&&(d+=$(e).text()),l=$(e)}),l&&1===d.length&&t.editor.util.browser.firefox&&!l.next("br").length?(n=$(t.editor.util.phBr).insertAfter(l),l.remove(),t.editor.selection.setRangeBefore(n),!0):d.length>0?!1:(u=document.createRange(),s=a.children("ul, ol"),s.length>0?(o=$("<li/>").append(t.editor.util.phBr).appendTo(s),s.append(r.children("li")),i.remove(),t.editor.selection.setRangeAtEndOf(o,u)):(t.editor.selection.setRangeAtEndOf(a,u),a.append(r),i.remove(),t.editor.selection.selectRange(u)),!0)):!1}}(this)),this.editor.inputManager.addKeystrokeHandler("8","pre",function(t){return function(e,i){var n,r,o;if(t.editor.selection.rangeAtStartOf(i))return r=i.html().replace("\n","<br/>"),n=$("<p/>").append(r||t.editor.util.phBr).insertAfter(i),i.remove(),o=document.createRange(),t.editor.selection.setRangeAtStartOf(n,o),!0}}(this)),this.editor.inputManager.addKeystrokeHandler("8","blockquote",function(t){return function(e,i){var n,r;if(t.editor.selection.rangeAtStartOf(i))return n=i.children().first().unwrap(),r=document.createRange(),t.editor.selection.setRangeAtStartOf(n,r),!0}}(this))},e}(B),z=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.pluginName="UndoManager",e.prototype._index=-1,e.prototype._capacity=50,e.prototype._timer=null,e.prototype._init=function(){var t,e;return this.editor=this._module,this._stack=[],this.editor.util.os.mac?(e="cmd+z",t="shift+cmd+z"):this.editor.util.os.win?(e="ctrl+z",t="ctrl+y"):(e="ctrl+z",t="shift+ctrl+z"),this.editor.inputManager.addShortcut(e,function(t){return function(e){return e.preventDefault(),t.undo(),!1}}(this)),this.editor.inputManager.addShortcut(t,function(t){return function(e){return e.preventDefault(),t.redo(),!1}}(this)),this.editor.on("valuechanged",function(t){return function(e,i){return"undo"!==i&&"redo"!==i?(t._timer&&(clearTimeout(t._timer),t._timer=null),t._timer=setTimeout(function(){return t._pushUndoState(),t._timer=null},200)):void 0}}(this))},e.prototype._pushUndoState=function(){var t,e;if(this.editor.triggerHandler("pushundostate")!==!1&&(t=this.currentState(),e=this.editor.body.html(),!t||t.html!==e))return this._index+=1,this._stack.length=this._index,this._stack.push({html:e,caret:this.caretPosition()}),this._stack.length>this._capacity?(this._stack.shift(),this._index-=1):void 0},e.prototype.currentState=function(){return this._stack.length&&this._index>-1?this._stack[this._index]:null},e.prototype.undo=function(){var t;if(!(this._index<1||this._stack.length<2))return this.editor.hidePopover(),this._index-=1,t=this._stack[this._index],this.editor.body.html(t.html),this.caretPosition(t.caret),this.editor.body.find(".selected").removeClass("selected"),this.editor.sync(),this.editor.trigger("valuechanged",["undo"])},e.prototype.redo=function(){var t;if(!(this._index<0||this._stack.length<this._index+2))return this.editor.hidePopover(),this._index+=1,t=this._stack[this._index],this.editor.body.html(t.html),this.caretPosition(t.caret),this.editor.body.find(".selected").removeClass("selected"),this.editor.sync(),this.editor.trigger("valuechanged",["redo"])},e.prototype.update=function(){var t,e;if(!this._timer&&(t=this.currentState()))return e=this.editor.body.html(),t.html=e,t.caret=this.caretPosition()},e.prototype._getNodeOffset=function(t,e){var i,n,r;return i=e?$(t):$(t).parent(),r=0,n=!1,i.contents().each(function(i){return function(i,o){return e===i||t===o?!1:(3===o.nodeType?n||(r+=1,n=!0):(r+=1,n=!1),null)}}(this)),r},e.prototype._getNodePosition=function(t,e){var i,n;if(3===t.nodeType)for(n=t.previousSibling;n&&3===n.nodeType;)t=n,e+=this.editor.util.getNodeLength(n),n=n.previousSibling;else e=this._getNodeOffset(t,e);return i=[],i.unshift(e),this.editor.util.traverseUp(function(t){return function(e){return i.unshift(t._getNodeOffset(e))}}(this),t),i},e.prototype._getNodeByPosition=function(t){var e,i,n,r,o,s,a,l;for(s=this.editor.body[0],l=t.slice(0,t.length-1),n=r=0,o=l.length;o>r;n=++r){if(a=l[n],i=s.childNodes,a>i.length-1){if(n!==t.length-2||!$(s).is("pre")){s=null;break}e=document.createTextNode(""),s.appendChild(e),i=s.childNodes}s=i[a]}return s},e.prototype.caretPosition=function(t){var e,i,n,r,o;if(t){if(this.editor.inputManager.focused||this.editor.body.focus(),!t.start)return void this.editor.body.blur();if(r=this._getNodeByPosition(t.start),o=t.start[t.start.length-1],t.collapsed?(e=r,i=o):(e=this._getNodeByPosition(t.end),i=t.start[t.start.length-1]),!r||!e)throw new Error("simditor: invalid caret state");return n=document.createRange(),n.setStart(r,o),n.setEnd(e,i),this.editor.selection.selectRange(n)}return n=this.editor.selection.getRange(),this.editor.inputManager.focused&&null!=n?(t={start:[],end:null,collapsed:!0},t.start=this._getNodePosition(n.startContainer,n.startOffset),n.collapsed||(t.end=this._getNodePosition(n.endContainer,n.endOffset),t.collapsed=!1),t):{}},e}(B),H=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.pluginName="Util",e.prototype._init=function(){return this.editor=this._module,this.browser.msie&&this.browser.version<11?this.phBr="":void 0},e.prototype.phBr="<br/>",e.prototype.os=function(){var t;return t={},/Mac/.test(navigator.appVersion)?t.mac=!0:/Linux/.test(navigator.appVersion)?t.linux=!0:/Win/.test(navigator.appVersion)?t.win=!0:/X11/.test(navigator.appVersion)&&(t.unix=!0),/Mobi/.test(navigator.appVersion)&&(t.mobile=!0),t}(),e.prototype.browser=function(){var t,e,i,n,r,o,s,a,l;return l=navigator.userAgent,i=/(msie|trident)/i.test(l),t=/chrome|crios/i.test(l),a=/safari/i.test(l)&&!t,e=/firefox/i.test(l),i?{msie:!0,version:1*(null!=(n=l.match(/(msie |rv:)(\d+(\.\d+)?)/i))?n[2]:void 0)}:t?{webkit:!0,chrome:!0,version:1*(null!=(r=l.match(/(?:chrome|crios)\/(\d+(\.\d+)?)/i))?r[1]:void 0)}:a?{webkit:!0,safari:!0,version:1*(null!=(o=l.match(/version\/(\d+(\.\d+)?)/i))?o[1]:void 0)}:e?{mozilla:!0,firefox:!0,version:1*(null!=(s=l.match(/firefox\/(\d+(\.\d+)?)/i))?s[1]:void 0)}:{}}(),e.prototype.support=function(){return{onselectionchange:function(){var t,e;if(e=document.onselectionchange,void 0!==e)try{return document.onselectionchange=0,null===document.onselectionchange}catch(i){t=i}finally{document.onselectionchange=e}return!1}(),oninput:function(){return!/(msie|trident)/i.test(navigator.userAgent)}()}}(),e.prototype.reflow=function(t){return null==t&&(t=document),$(t)[0].offsetHeight},e.prototype.metaKey=function(t){var e;return e=/Mac/.test(navigator.userAgent),e?t.metaKey:t.ctrlKey},e.prototype.isEmptyNode=function(t){var e;return e=$(t),e.is(":empty")||!e.text()&&!e.find(":not(br, span, div)").length},e.prototype.blockNodes=["div","p","ul","ol","li","blockquote","hr","pre","h1","h2","h3","h4","table"],e.prototype.isBlockNode=function(t){return t=$(t)[0],t&&3!==t.nodeType?new RegExp("^("+this.blockNodes.join("|")+")$").test(t.nodeName.toLowerCase()):!1},e.prototype.closestBlockEl=function(t){var e,i,n;return null==t&&(n=this.editor.selection.getRange(),t=null!=n?n.commonAncestorContainer:void 0),e=$(t),e.length?(i=e.parentsUntil(this.editor.body).addBack(),i=i.filter(function(t){return function(e){return t.isBlockNode(i.eq(e))}}(this)),i.length?i.last():null):null},e.prototype.furthestNode=function(t,e){var i,n,r;return null==t&&(r=this.editor.selection.getRange(),t=null!=r?r.commonAncestorContainer:void 0),i=$(t),i.length?(n=i.parentsUntil(this.editor.body).addBack(),n=n.filter(function(t){return function(t){var i;return i=n.eq(t),$.isFunction(e)?e(i):i.is(e)}}(this)),n.length?n.first():null):null},e.prototype.furthestBlockEl=function(t){return this.furthestNode(t,$.proxy(this.isBlockNode,this))},e.prototype.getNodeLength=function(t){switch(t.nodeType){case 7:case 10:return 0;case 3:case 8:return t.length;default:return t.childNodes.length}},e.prototype.traverseUp=function(t,e){var i,n,r,o,s,a,l;if(null==e&&(s=this.editor.selection.getRange(),e=null!=s?s.commonAncestorContainer:void 0),null==e||!$.contains(this.editor.body[0],e))return!1;for(o=$(e).parentsUntil(this.editor.body).get(),o.unshift(e),l=[],i=0,n=o.length;n>i&&(r=o[i],a=t(r),a!==!1);i++)l.push(void 0);return l},e.prototype.dataURLtoBlob=function(t){var e,i,n,r,o,s,a,l,u,d,h;if(s=window.Blob&&function(){var t;try{return Boolean(new Blob)}catch(e){return t=e,!1}}(),o=s&&window.Uint8Array&&function(){var t;try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return t=e,!1}}(),e=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,!((s||e)&&window.atob&&window.ArrayBuffer&&window.Uint8Array))return!1;for(r=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):decodeURIComponent(t.split(",")[1]),i=new ArrayBuffer(r.length),l=new Uint8Array(i),a=u=0,h=r.length;h>=0?h>=u:u>=h;a=h>=0?++u:--u)l[a]=r.charCodeAt(a);return d=t.split(",")[0].split(":")[1].split(";")[0],s?new Blob([o?l:i],{type:d}):(n=new e,n.append(i),n.getBlob(d))},e.prototype.throttle=function(t,e){var i,n,r;return i=null,n=0,r=function(){return i?(clearTimeout(i),i=null):void 0},function(){var o,s,a,l;return s=Date.now(),n||(n=s),a=e-(s-n),l=null,a>0&&e>a?(n=s,r(),o=arguments,i=setTimeout(function(){return n=0,i=null,l=t.apply(null,o)},e)):(r(),n!==s&&(n=0),l=t.apply(null,arguments)),l}},e.prototype.formatHTML=function(t){var e,i,n,r,o,s,a,l,u;for(s=/<(\/?)(.+?)(\/?)>/g,l="",r=0,n=null,i="  ",a=function(t,e){return new Array(e+1).join(t)};null!==(o=s.exec(t));)o.isBlockNode=$.inArray(o[2],this.blockNodes)>-1,o.isStartTag="/"!==o[1]&&"/"!==o[3],o.isEndTag="/"===o[1]||"/"===o[3],e=n?n.index+n[0].length:0,(u=t.substring(e,o.index)).length>0&&$.trim(u)&&(l+=u),o.isBlockNode&&o.isEndTag&&!o.isStartTag&&(r-=1),o.isBlockNode&&o.isStartTag&&(n&&n.isBlockNode&&n.isEndTag||(l+="\n"),l+=a(i,r)),l+=o[0],o.isBlockNode&&o.isEndTag&&(l+="\n"),o.isBlockNode&&o.isStartTag&&(r+=1),n=o;return $.trim(l)},e}(B),O=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.pluginName="Toolbar",e.prototype.opts={toolbar:!0,toolbarFloat:!0,toolbarHidden:!1,toolbarFloatOffset:0},e.prototype._tpl={wrapper:'<div class="simditor-toolbar"><ul></ul></div>',separator:'<li><span class="separator"></span></li>'},e.prototype._init=function(){var t;return this.editor=this._module,this.opts.toolbar?($.isArray(this.opts.toolbar)||(this.opts.toolbar=["bold","italic","underline","strikethrough","|","ol","ul","blockquote","code","|","link","image","|","indent","outdent"]),this._render(),this.list.on("click",function(t){return function(t){return!1}}(this)),this.wrapper.on("mousedown",function(t){return function(e){return t.list.find(".menu-on").removeClass(".menu-on")}}(this)),$(document).on("mousedown.simditor"+this.editor.id,function(t){return function(e){return t.list.find(".menu-on").removeClass(".menu-on")}}(this)),!this.opts.toolbarHidden&&this.opts.toolbarFloat&&(this.wrapper.css("top",this.opts.toolbarFloatOffset),t=0,$(window).on("resize.simditor-"+this.editor.id,function(e){return function(i){return e.wrapper.css("position","static"),e.wrapper.width("auto"),e.editor.util.reflow(e.wrapper),e.wrapper.width(e.wrapper.outerWidth()),e.wrapper.css("left",e.wrapper.offset().left),e.wrapper.css("position",""),t=e.wrapper.outerHeight(),e.editor.placeholderEl.css("top",t)}}(this)).resize(),$(window).on("scroll.simditor-"+this.editor.id,function(e){return function(i){var n,r,o;if(o=e.editor.wrapper.offset().top,n=o+e.editor.wrapper.outerHeight()-80,r=$(document).scrollTop()+e.opts.toolbarFloatOffset,o>=r||r>=n){if(e.editor.wrapper.removeClass("toolbar-floating").css("padding-top",""),e.editor.util.os.mobile)return e.wrapper.css("top",e.opts.toolbarFloatOffset)}else if(e.editor.wrapper.addClass("toolbar-floating").css("padding-top",t),e.editor.util.os.mobile)return e.wrapper.css("top",r-o+e.opts.toolbarFloatOffset)}}(this))),this.editor.on("selectionchanged",function(t){return function(){return t.toolbarStatus()}}(this)),this.editor.on("destroy",function(t){return function(){return t.buttons.length=0}}(this)),$(document).on("mousedown.simditor-"+this.editor.id,function(t){return function(e){return t.list.find("li.menu-on").removeClass("menu-on")}}(this))):void 0},e.prototype._render=function(){var t,e,i,n;for(this.buttons=[],this.wrapper=$(this._tpl.wrapper).prependTo(this.editor.wrapper),this.list=this.wrapper.find("ul"),n=this.opts.toolbar,t=0,e=n.length;e>t;t++)if(i=n[t],"|"!==i){if(!this.constructor.buttons[i])throw new Error('simditor: invalid toolbar button "'+i+'"');this.buttons.push(new this.constructor.buttons[i]({editor:this.editor}))}else $(this._tpl.separator).appendTo(this.list);return this.opts.toolbarHidden?this.wrapper.hide():void 0},e.prototype.toolbarStatus=function(t){var e;if(this.editor.inputManager.focused)return e=this.buttons.slice(0),this.editor.util.traverseUp(function(i){return function(i){var n,r,o,s,a,l,u;for(u=[],r=o=0,a=e.length;a>o;r=++o)n=e[r],(null==t||n.name===t)&&(n.status&&n.status($(i))!==!0||u.push(n));for(s=0,l=u.length;l>s;s++)n=u[s],r=$.inArray(n,e),e.splice(r,1);return 0===e.length?!1:void 0}}(this))},e.prototype.findButton=function(t){var e;return e=this.list.find(".toolbar-item-"+t).data("button"),null!=e?e:null},e.addButton=function(t){return this.buttons[t.prototype.name]=t},e.buttons={},e}(B),g=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.pluginName="Indentation",e.prototype.opts={tabIndent:!0},e.prototype._init=function(){return this.editor=this._module,this.editor.inputManager.addKeystrokeHandler("9","*",function(t){return function(e){var i;return i=t.editor.toolbar.findButton("code"),t.opts.tabIndent||i&&i.active?t.indent(e.shiftKey):void 0}}(this))},e.prototype.indent=function(t){var e,i,n,r,o;return(r=this.editor.selection.getRange())?(n=this.editor.util.closestBlockEl(r.startContainer),i=this.editor.util.closestBlockEl(r.endContainer),n.is("li")&&i.is("li")&&n.parent().is(i.parent())||(n=this.editor.util.furthestBlockEl(n),i=this.editor.util.furthestBlockEl(i)),e=n.is(i)?n:n.nextUntil(i).add(n).add(i),o=!1,e.each(function(e){return function(i,n){return o=t?e.outdentBlock(n):e.indentBlock(n)}}(this)),o):void 0},e.prototype.indentBlock=function(t){var e,i,n,r,o,s,a,l,u,d,h;if(e=$(t),e.length){if(e.is("pre")){if(d=this.editor.selection.getRange(),s=$(d.commonAncestorContainer),!s.is(e)&&!s.closest("pre").is(e))return;this.indentText(d)}else if(e.is("li")){if(o=e.prev("li"),o.length<1)return;this.editor.selection.save(),h=e.parent()[0].tagName,i=o.children("ul, ol"),i.length>0?i.append(e):$("<"+h+"/>").append(e).appendTo(o),this.editor.selection.restore()}else if(e.is("p, h1, h2, h3, h4"))u=e.attr("data-indent")||0,u=Math.min(1*u+1,10),e.attr("data-indent",u);else if(e.is("table")||e.is(".simditor-table")){if(d=this.editor.selection.getRange(),a=$(d.commonAncestorContainer).closest("td, th"),n=a.next("td, th"),n.length>0||(l=a.parent("tr"),r=l.next("tr"),r.length<1&&l.parent().is("thead")&&(r=l.parent("thead").next("tbody").find("tr:first")),n=r.find("td:first, th:first")),!(a.length>0&&n.length>0))return!1;this.editor.selection.setRangeAtEndOf(n)}return!0}},e.prototype.indentText=function(t){var e,i;return e=t.toString().replace(/^(?=.+)/gm,"  "),i=document.createTextNode(e||"  "),t.deleteContents(),t.insertNode(i),e?(t.selectNode(i),this.editor.selection.selectRange(t)):this.editor.selection.setRangeAfter(i)},e.prototype.outdentBlock=function(t){var e,i,n,r,o,s,a,l,u,d,h,c;if(e=$(t),e&&e.length>0){if(e.is("pre")){if(h=this.editor.selection.getRange(),r=$(h.commonAncestorContainer),!r.is(e)&&!r.closest("pre").is(e))return;this.outdentText(h)}else if(e.is("li")){if(i=e.parent(),n=i.parent("li"),n.length<1)return u=this.editor.toolbar.findButton(i[0].tagName.toLowerCase()),void(null!=u&&u.command());this.editor.selection.save(),e.next("li").length>0&&$("<"+i[0].tagName+"/>").append(e.nextAll("li")).appendTo(e),e.insertAfter(n),i.children("li").length<1&&i.remove(),this.editor.selection.restore()}else if(e.is("p, h1, h2, h3, h4"))d=null!=(c=e.attr("data-indent"))?c:0,d=1*d-1,0>d&&(d=0),e.attr("data-indent",d);else if(e.is("table")||e.is(".simditor-table")){if(h=this.editor.selection.getRange(),a=$(h.commonAncestorContainer).closest("td, th"),o=a.prev("td, th"),o.length>0||(l=a.parent("tr"),s=l.prev("tr"),s.length<1&&l.parent().is("tbody")&&(s=l.parent("tbody").prev("thead").find("tr:first")),o=s.find("td:last, th:last")),!(a.length>0&&o.length>0))return;this.editor.selection.setRangeAtEndOf(o)}return!0}},e.prototype.outdentText=function(t){},e}(B),N=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.connect(H),e.connect(m),e.connect(z),e.connect(_),e.connect(l),e.connect(E),e.connect(O),e.connect(g),e.count=0,e.prototype.opts={textarea:null,placeholder:"",defaultImage:"images/image.png",params:{},upload:!1},e.prototype._init=function(){var t,i,n,r;if(this.textarea=$(this.opts.textarea),this.opts.placeholder=this.opts.placeholder||this.textarea.attr("placeholder"),!this.textarea.length)throw new Error("simditor: param textarea is required.");if(i=this.textarea.data("simditor"),null!=i&&i.destroy(),this.id=++e.count,this._render(),this.opts.upload&&simpleUploader&&(r="object"==typeof this.opts.upload?this.opts.upload:{},this.uploader=simpleUploader(r)),n=this.textarea.closest("form"),n.length&&(n.on("submit.simditor-"+this.id,function(t){return function(){return t.sync()}}(this)),n.on("reset.simditor-"+this.id,function(t){return function(){return t.setValue("")}}(this))),this.on("initialized",function(t){return function(){return t.opts.placeholder&&t.on("valuechanged",function(){return t._placeholder()}),t.setValue(t.textarea.val().trim()||"")}}(this)),this.util.browser.mozilla){this.util.reflow();try{return document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1)}catch(o){t=o}}},e.prototype._tpl='<div class="simditor">\n  <div class="simditor-wrapper">\n    <div class="simditor-placeholder"></div>\n    <div class="simditor-body" contenteditable="true">\n    </div>\n  </div>\n</div>',e.prototype._render=function(){var t,e,i,n;if(this.el=$(this._tpl).insertBefore(this.textarea),this.wrapper=this.el.find(".simditor-wrapper"),this.body=this.wrapper.find(".simditor-body"),this.placeholderEl=this.wrapper.find(".simditor-placeholder").append(this.opts.placeholder),this.el.data("simditor",this),this.wrapper.append(this.textarea),this.textarea.data("simditor",this).blur(),this.body.attr("tabindex",this.textarea.attr("tabindex")),this.util.os.mac?this.el.addClass("simditor-mac"):this.util.os.linux&&this.el.addClass("simditor-linux"),this.util.os.mobile&&this.el.addClass("simditor-mobile"),this.opts.params){e=this.opts.params,i=[];for(t in e)n=e[t],i.push($("<input/>",{type:"hidden",name:t,value:n}).insertAfter(this.textarea));return i}},e.prototype._placeholder=function(){var t,e;return t=this.body.children(),0===t.length||1===t.length&&this.util.isEmptyNode(t)&&(null!=(e=t.data("indent"))?e:0)<1?this.placeholderEl.show():this.placeholderEl.hide()},e.prototype.setValue=function(t){return this.hidePopover(),this.textarea.val(t),this.body.html(t),this.formatter.format(),this.formatter.decorate(),this.util.reflow(this.body),this.inputManager.lastCaretPosition=null,this.trigger("valuechanged")},e.prototype.getValue=function(){return this.sync()},e.prototype.sync=function(){var t,e,i,n,r,o;for(e=this.body.clone(),this.formatter.undecorate(e),this.formatter.format(e),this.formatter.autolink(e),t=e.children(),r=t.last("p"),n=t.first("p");r.is("p")&&this.util.isEmptyNode(r);)i=r,r=r.prev("p"),i.remove();for(;n.is("p")&&this.util.isEmptyNode(n);)i=n,n=r.next("p"),i.remove();return e.find("img.uploading").remove(),o=$.trim(e.html()),this.textarea.val(o),o},e.prototype.focus=function(){var t,e;return this.body.is(":visible")&&this.body.is("[contenteditable]")?this.inputManager.lastCaretPosition?this.undoManager.caretPosition(this.inputManager.lastCaretPosition):(t=this.body.find("p").last(),t.length>0||(t=$("<p/>").append(this.util.phBr).appendTo(this.body)),e=document.createRange(),this.selection.setRangeAtEndOf(t,e),this.body.focus()):void this.el.find("textarea:visible").focus()},e.prototype.blur=function(){return this.body.is(":visible")&&this.body.is("[contenteditable]")?this.body.blur():this.body.find("textarea:visible").blur()},e.prototype.hidePopover=function(){return this.el.find(".simditor-popover").each(function(t){return function(t,e){return e=$(e).data("popover"),e&&e.active?e.hide():void 0}}(this))},e.prototype.destroy=function(){return this.triggerHandler("destroy"),this.textarea.closest("form").off(".simditor .simditor-"+this.id),this.selection.clear(),this.inputManager.focused=!1,this.textarea.insertBefore(this.el).hide().val("").removeData("simditor"),this.el.remove(),$(document).off(".simditor-"+this.id),$(window).off(".simditor-"+this.id),this.off()},e}(B),N.i18n={"zh-CN":{blockquote:"引用",bold:"加粗文字",code:"插入代码",color:"文字颜色",hr:"分隔线",image:"插入图片",externalImage:"外链图片",uploadImage:"上传图片",uploadFailed:"上传失败了",uploadError:"上传出错了",imageUrl:"图片地址",imageSize:"图片尺寸",imageAlt:"图片描述",restoreImageSize:"还原图片尺寸",uploading:"正在上传",indent:"向右缩进",outdent:"向左缩进",italic:"斜体文字",link:"插入链接",text:"文本",linkText:"链接文字",linkUrl:"地址",removeLink:"移除链接",ol:"有序列表",ul:"无序列表",strikethrough:"删除线文字",table:"表格",deleteRow:"删除行",insertRowAbove:"在上面插入行",insertRowBelow:"在下面插入行",deleteColumn:"删除列",insertColumnLeft:"在左边插入列",insertColumnRight:"在右边插入列",deleteTable:"删除表格",title:"标题",normalText:"普通文本",underline:"下划线文字",
alignment:"水平对齐",alignCenter:"居中",alignLeft:"居左",alignRight:"居右",selectLanguage:"选择程序语言",html:"源代码编辑模式",fullscreen:"全屏模式",qiniu:"插入图片",word:"导入 Word 文档",video:"插入视频",map:"插入百度地图",background:"设置表格背景颜色"}},r=function(t){function e(t){this.editor=t.editor,this.title=this._t(this.name),e.__super__.constructor.call(this,t)}return q(e,t),e.prototype._tpl={item:'<li><a tabindex="-1" unselectable="on" class="toolbar-item" href="javascript:;"><span></span></a></li>',menuWrapper:'<div class="toolbar-menu"></div>',menuItem:'<li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;"><span></span></a></li>',separator:'<li><span class="separator"></span></li>'},e.prototype.name="",e.prototype.icon="",e.prototype.title="",e.prototype.text="",e.prototype.htmlTag="",e.prototype.disableTag="",e.prototype.menu=!1,e.prototype.active=!1,e.prototype.disabled=!1,e.prototype.needFocus=!0,e.prototype.shortcut=null,e.prototype._init=function(){var t,e,i,n,r;for(this.render(),this.el.on("mousedown",function(t){return function(e){var i,n;return e.preventDefault(),t.el.hasClass("disabled")||t.needFocus&&!t.editor.inputManager.focused?!1:t.menu?(t.wrapper.toggleClass("menu-on").siblings("li").removeClass("menu-on"),t.wrapper.is(".menu-on")&&(i=t.menuWrapper.offset().left+t.menuWrapper.outerWidth()+5-t.editor.wrapper.offset().left-t.editor.wrapper.outerWidth(),i>0&&t.menuWrapper.css({left:"auto",right:0}),t.trigger("menuexpand")),!1):(n=t.el.data("param"),t.command(n),!1)}}(this)),this.wrapper.on("click","a.menu-item",function(t){return function(e){var i,n;return e.preventDefault(),i=$(e.currentTarget),t.wrapper.removeClass("menu-on"),i.hasClass("disabled")||t.needFocus&&!t.editor.inputManager.focused?!1:(t.editor.toolbar.wrapper.removeClass("menu-on"),n=i.data("param"),t.command(n),!1)}}(this)),this.wrapper.on("mousedown","a.menu-item",function(t){return function(t){return!1}}(this)),this.editor.on("blur",function(t){return function(){return t.editor.body.is(":visible")&&t.editor.body.is("[contenteditable]")?(t.setActive(!1),t.setDisabled(!1)):void 0}}(this)),null!=this.shortcut&&this.editor.inputManager.addShortcut(this.shortcut,function(t){return function(e){return t.el.mousedown(),!1}}(this)),i=this.htmlTag.split(","),n=[],t=0,e=i.length;e>t;t++)r=i[t],r=$.trim(r),n.push(r&&$.inArray(r,this.editor.formatter._allowedTags)<0?this.editor.formatter._allowedTags.push(r):void 0);return n},e.prototype.iconClassOf=function(t){return t?"simditor-icon simditor-icon-"+t:""},e.prototype.setIcon=function(t){return this.el.find("span").removeClass().addClass(this.iconClassOf(t)).text(this.text)},e.prototype.render=function(){return this.wrapper=$(this._tpl.item).appendTo(this.editor.toolbar.list),this.el=this.wrapper.find("a.toolbar-item"),this.el.attr("title",this.title).addClass("toolbar-item-"+this.name).data("button",this),this.setIcon(this.icon),this.menu?(this.menuWrapper=$(this._tpl.menuWrapper).appendTo(this.wrapper),this.menuWrapper.addClass("toolbar-menu-"+this.name),this.renderMenu()):void 0},e.prototype.renderMenu=function(){var t,e,i,n,r,o,s,a;if($.isArray(this.menu)){for(this.menuEl=$("<ul/>").appendTo(this.menuWrapper),o=this.menu,a=[],i=0,n=o.length;n>i;i++)r=o[i],"|"!==r?(e=$(this._tpl.menuItem).appendTo(this.menuEl),t=e.find("a.menu-item").attr({title:null!=(s=r.title)?s:r.text,"data-param":r.param}).addClass("menu-item-"+r.name),a.push(r.icon?t.find("span").addClass(this.iconClassOf(r.icon)):t.find("span").text(r.text))):$(this._tpl.separator).appendTo(this.menuEl);return a}},e.prototype.setActive=function(t){return t!==this.active?(this.active=t,this.el.toggleClass("active",this.active),this.editor.toolbar.trigger("buttonstatus",[this])):void 0},e.prototype.setDisabled=function(t){return t!==this.disabled?(this.disabled=t,this.el.toggleClass("disabled",this.disabled),this.editor.toolbar.trigger("buttonstatus",[this])):void 0},e.prototype.status=function(t){return null!=t&&this.setDisabled(t.is(this.disableTag)),this.disabled?!0:(null!=t&&this.setActive(t.is(this.htmlTag)),this.active)},e.prototype.command=function(t){},e.prototype._t=function(){var t,i,n;return t=1<=arguments.length?P.call(arguments,0):[],n=e.__super__._t.apply(this,t),n||(n=(i=this.editor)._t.apply(i,t)),n},e}(B),N.Button=r,C=function(t){function e(t){this.button=t.button,this.editor=t.button.editor,e.__super__.constructor.call(this,t)}return q(e,t),e.prototype.offset={top:4,left:0},e.prototype.target=null,e.prototype.active=!1,e.prototype._init=function(){return this.el=$('<div class="simditor-popover"></div>').appendTo(this.editor.el).data("popover",this),this.render(),this.el.on("mouseenter",function(t){return function(e){return t.el.addClass("hover")}}(this)),this.el.on("mouseleave",function(t){return function(e){return t.el.removeClass("hover")}}(this))},e.prototype.render=function(){},e.prototype.show=function(t,e){return null==e&&(e="bottom"),null!=t?(this.el.siblings(".simditor-popover").each(function(t){return function(t,e){return e=$(e).data("popover"),e.active?e.hide():void 0}}(this)),this.active&&this.target&&this.target.removeClass("selected"),this.target=t.addClass("selected"),this.active?(this.refresh(e),this.trigger("popovershow")):(this.active=!0,this.el.css({left:-9999}).show(),setTimeout(function(t){return function(){return t.refresh(e),t.trigger("popovershow")}}(this),0))):void 0},e.prototype.hide=function(){return this.active?(this.target&&this.target.removeClass("selected"),this.target=null,this.active=!1,this.el.hide(),this.trigger("popoverhide")):void 0},e.prototype.refresh=function(t){var e,i,n,r,o;return null==t&&(t="bottom"),this.active?(e=this.editor.el.offset(),r=this.target.offset(),n=this.target.outerHeight(),"bottom"===t?o=r.top-e.top+n:"top"===t&&(o=r.top-e.top-this.el.height()),i=Math.min(r.left-e.left,this.editor.wrapper.width()-this.el.outerWidth()-10),this.el.css({top:o+this.offset.top,left:i+this.offset.left})):void 0},e.prototype.destroy=function(){return this.target=null,this.active=!1,this.editor.off(".linkpopover"),this.el.remove()},e.prototype._t=function(){var t,i,n;return t=1<=arguments.length?P.call(arguments,0):[],n=e.__super__._t.apply(this,t),n||(n=(i=this.button)._t.apply(i,t)),n},e}(B),N.Popover=C,M=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.name="title",e.prototype.htmlTag="h1, h2, h3, h4",e.prototype.disableTag="pre, table",e.prototype._init=function(){return this.menu=[{name:"normal",text:this._t("normalText"),param:"p"},"|",{name:"h1",text:this._t("title")+" 1",param:"h1"},{name:"h2",text:this._t("title")+" 2",param:"h2"},{name:"h3",text:this._t("title")+" 3",param:"h3"},{name:"h4",text:this._t("title")+" 4",param:"h4"},{name:"h5",text:this._t("title")+" 5",param:"h5"}],e.__super__._init.call(this)},e.prototype.setActive=function(t,i){return e.__super__.setActive.call(this,t),this.el.removeClass("active-p active-h1 active-h2 active-h3"),t?this.el.addClass("active active-"+i):void 0},e.prototype.status=function(t){var e,i;return null!=t&&this.setDisabled(t.is(this.disableTag)),this.disabled?!0:(null!=t&&(e=null!=(i=t[0].tagName)?i.toLowerCase():void 0,this.setActive(t.is(this.htmlTag),e)),this.active)},e.prototype.command=function(t){var e,i,n,r,o,s,a,l,u,d,h;for(l=this.editor.selection.getRange(),h=l.startContainer,r=l.endContainer,n=this.editor.util.closestBlockEl(h),i=this.editor.util.closestBlockEl(r),this.editor.selection.save(),l.setStartBefore(n[0]),l.setEndAfter(i[0]),e=$(l.extractContents()),d=[],e.children().each(function(e){return function(i,n){var r,o,s,a,l;for(o=e._convertEl(n,t),l=[],s=0,a=o.length;a>s;s++)r=o[s],l.push(d.push(r));return l}}(this)),u=d.reverse(),o=0,s=u.length;s>o;o++)a=u[o],l.insertNode(a[0]);return this.editor.selection.restore(),this.editor.trigger("valuechanged")},e.prototype._convertEl=function(t,e){var i,n,r;return n=$(t),r=[],n.is(e)?r.push(n):(i=$("<"+e+"/>").append(n.contents()),r.push(i)),r},e}(r),N.Toolbar.addButton(M),n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.name="bold",e.prototype.icon="bold",e.prototype.htmlTag="b, strong",e.prototype.disableTag="pre",e.prototype.shortcut="cmd+b",e.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + b )":(this.title=this.title+" ( Ctrl + b )",this.shortcut="ctrl+b"),e.__super__._init.call(this)},e.prototype.status=function(t){var e;return null!=t&&this.setDisabled(t.is(this.disableTag)),this.disabled?!0:(e=document.queryCommandState("bold")===!0,this.setActive(e),e)},e.prototype.command=function(){return document.execCommand("bold"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),$(document).trigger("selectionchange")},e}(r),N.Toolbar.addButton(n),v=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.name="italic",e.prototype.icon="italic",e.prototype.htmlTag="i",e.prototype.disableTag="pre",e.prototype.shortcut="cmd+i",e.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + i )":(this.title=this.title+" ( Ctrl + i )",this.shortcut="ctrl+i"),e.__super__._init.call(this)},e.prototype.status=function(t){var e;return null!=t&&this.setDisabled(t.is(this.disableTag)),this.disabled?this.disabled:(e=document.queryCommandState("italic")===!0,this.setActive(e),e)},e.prototype.command=function(){return document.execCommand("italic"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),$(document).trigger("selectionchange")},e}(r),N.Toolbar.addButton(v),I=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.name="underline",e.prototype.icon="underline",e.prototype.htmlTag="u",e.prototype.disableTag="pre",e.prototype.shortcut="cmd+u",e.prototype.render=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + u )":(this.title=this.title+" ( Ctrl + u )",this.shortcut="ctrl+u"),e.__super__.render.call(this)},e.prototype.status=function(t){var e;return null!=t&&this.setDisabled(t.is(this.disableTag)),this.disabled?this.disabled:(e=document.queryCommandState("underline")===!0,this.setActive(e),e)},e.prototype.command=function(){return document.execCommand("underline"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),$(document).trigger("selectionchange")},e}(r),N.Toolbar.addButton(I),a=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.name="color",e.prototype.icon="tint",e.prototype.disableTag="pre",e.prototype.menu=!0,e.prototype.render=function(){var t;return t=1<=arguments.length?P.call(arguments,0):[],e.__super__.render.apply(this,t)},e.prototype.renderMenu=function(){return $('<ul class="color-list">\n  <li><a href="javascript:;" class="font-color font-color-1" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-2" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-3" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-4" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-5" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-6" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-7" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-default" data-color=""></a></li>\n</ul>').appendTo(this.menuWrapper),this.menuWrapper.on("mousedown",".color-list",function(t){return!1}),this.menuWrapper.on("click",".font-color",function(t){return function(e){var i,n,r,o;if(t.wrapper.removeClass("menu-on"),i=$(e.currentTarget),i.hasClass("font-color-default")){if(n=t.editor.body.find("p, li"),!(n.length>0))return;o=window.getComputedStyle(n[0],null).getPropertyValue("color"),r=t._convertRgbToHex(o)}else o=window.getComputedStyle(i[0],null).getPropertyValue("background-color"),r=t._convertRgbToHex(o);return r?(document.execCommand("foreColor",!1,r),t.editor.util.support.oninput?void 0:t.editor.trigger("valuechanged")):void 0}}(this))},e.prototype._convertRgbToHex=function(t){var e,i,n;return i=/rgb\((\d+),\s?(\d+),\s?(\d+)\)/g,(e=i.exec(t))?(n=function(t,e,i){var n;return n=function(t){var e;return e=t.toString(16),1===e.length?"0"+e:e},"#"+n(t)+n(e)+n(i)})(1*e[1],1*e[2],1*e[3]):""},e}(r),N.Toolbar.addButton(a),w=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.type="",e.prototype.disableTag="pre, table",e.prototype.status=function(t){var e;return null!=t&&this.setDisabled(t.is(this.disableTag)),this.disabled?!0:null==t?this.active:(e="ul"===this.type?"ol":"ul",t.is(e)?(this.setActive(!1),!0):(this.setActive(t.is(this.htmlTag)),this.active))},e.prototype.command=function(t){var e,i,n,r,o,s,a,l,u,d,h,c,p,f,g,m,v;for(p=this.editor.selection.getRange(),v=p.startContainer,l=p.endContainer,s=this.editor.util.closestBlockEl(v),i=this.editor.util.closestBlockEl(l),this.editor.selection.save(),p.setStartBefore(s[0]),p.setEndAfter(i[0]),s.is("li")&&i.is("li")&&(r=this.editor.util.furthestNode(s,"ul, ol"),n=this.editor.util.furthestNode(i,"ul, ol"),r.is(n)?(u=function(t){var e;for(e=1;!t.parent().is(r);)e+=1,t=t.parent();return e},m=u(s),a=u(i),o=m>a?i.parent():s.parent(),p.setStartBefore(o[0]),p.setEndAfter(o[0])):(p.setStartBefore(r[0]),p.setEndAfter(n[0]))),e=$(p.extractContents()),g=[],e.children().each(function(t){return function(e,i){var n,r,o,s,a;for(r=t._convertEl(i),a=[],o=0,s=r.length;s>o;o++)n=r[o],a.push(g.length&&g[g.length-1].is(t.type)&&n.is(t.type)?g[g.length-1].append(n.children()):g.push(n));return a}}(this)),f=g.reverse(),d=0,h=f.length;h>d;d++)c=f[d],p.insertNode(c[0]);return this.editor.selection.restore(),this.editor.trigger("valuechanged")},e.prototype._convertEl=function(t){var e,i,n,r,o,s,a,l,u;if(e=$(t),u=[],i="ul"===this.type?"ol":"ul",e.is(this.type))e.children("li").each(function(t){return function(e,i){var n,r,o;return r=$(i),n=r.children("ul, ol").remove(),o=$("<p/>").append($(i).html()||t.editor.util.phBr),u.push(o),n.length>0?u.push(n):void 0}}(this));else if(e.is(i))n=$("<"+this.type+"/>").append(e.html()),u.push(n);else if(e.is("blockquote")){for(l=e.children().get(),s=0,a=l.length;a>s;s++)r=l[s],o=this._convertEl(r);$.merge(u,o)}else e.is("table")||(n=$("<"+this.type+"><li></li></"+this.type+">"),n.find("li").append(e.html()||this.editor.util.phBr),u.push(n));return u},e}(r),T=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.type="ol",e.prototype.name="ol",e.prototype.icon="list-ol",e.prototype.htmlTag="ol",e.prototype.shortcut="cmd+/",e.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + / )":(this.title=this.title+" ( ctrl + / )",this.shortcut="ctrl+/"),e.__super__._init.call(this)},e}(w),F=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.type="ul",e.prototype.name="ul",e.prototype.icon="list-ul",e.prototype.htmlTag="ul",e.prototype.shortcut="cmd+.",e.prototype._init=function(){return this.editor.util.os.mac?this.title=this.title+" ( Cmd + . )":(this.title=this.title+" ( Ctrl + . )",this.shortcut="ctrl+."),e.__super__._init.call(this)},e}(w),N.Toolbar.addButton(T),N.Toolbar.addButton(F),i=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.name="blockquote",e.prototype.icon="quote-left",e.prototype.htmlTag="blockquote",e.prototype.disableTag="pre, table",e.prototype.command=function(){var t,e,i,n,r,o,s,a,l,u,d;for(a=this.editor.selection.getRange(),d=a.startContainer,n=a.endContainer,i=this.editor.util.furthestBlockEl(d),e=this.editor.util.furthestBlockEl(n),this.editor.selection.save(),a.setStartBefore(i[0]),a.setEndAfter(e[0]),t=$(a.extractContents()),u=[],t.children().each(function(t){return function(e,i){var n,r,o,s,a;for(r=t._convertEl(i),a=[],o=0,s=r.length;s>o;o++)n=r[o],a.push(u.length&&u[u.length-1].is(t.htmlTag)&&n.is(t.htmlTag)?u[u.length-1].append(n.children()):u.push(n));return a}}(this)),l=u.reverse(),r=0,o=l.length;o>r;r++)s=l[r],a.insertNode(s[0]);return this.editor.selection.restore(),this.editor.trigger("valuechanged")},e.prototype._convertEl=function(t){var e,i,n;return e=$(t),n=[],e.is(this.htmlTag)?e.children().each(function(t){return function(t,e){return n.push($(e))}}(this)):(i=$("<"+this.htmlTag+"/>").append(e),n.push(i)),n},e}(r),N.Toolbar.addButton(i),o=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.name="code",e.prototype.icon="code",e.prototype.htmlTag="pre",e.prototype.disableTag="li, table",e.prototype._init=function(){return e.__super__._init.call(this),this.editor.on("decorate",function(t){return function(e,i){return i.find("pre").each(function(e,i){return t.decorate($(i))})}}(this)),this.editor.on("undecorate",function(t){return function(e,i){return i.find("pre").each(function(e,i){return t.undecorate($(i))})}}(this))},e.prototype.render=function(){var t;return t=1<=arguments.length?P.call(arguments,0):[],e.__super__.render.apply(this,t),this.popover=new s({button:this})},e.prototype.status=function(t){var i;return i=e.__super__.status.call(this,t),this.active?this.popover.show(t):this.editor.util.isBlockNode(t)&&this.popover.hide(),i},e.prototype.decorate=function(t){var e,i,n,r;return e=t.find("> code"),e.length>0&&(i=null!=(n=e.attr("class"))&&null!=(r=n.match(/lang-(\S+)/))?r[1]:void 0,e.contents().unwrap(),i)?t.attr("data-lang",i):void 0},e.prototype.undecorate=function(t){var e,i;return i=t.attr("data-lang"),e=$("<code/>"),i&&-1!==i&&e.addClass("lang-"+i),t.wrapInner(e).removeAttr("data-lang")},e.prototype.command=function(){var t,e,i,n,r,o,s,a,l,u,d;for(a=this.editor.selection.getRange(),d=a.startContainer,n=a.endContainer,i=this.editor.util.closestBlockEl(d),e=this.editor.util.closestBlockEl(n),a.setStartBefore(i[0]),a.setEndAfter(e[0]),t=$(a.extractContents()),u=[],t.children().each(function(t){return function(e,i){var n,r,o,s,a;for(r=t._convertEl(i),a=[],o=0,s=r.length;s>o;o++)n=r[o],a.push(u.length&&u[u.length-1].is(t.htmlTag)&&n.is(t.htmlTag)?u[u.length-1].append(n.contents()):u.push(n));return a}}(this)),l=u.reverse(),r=0,o=l.length;o>r;r++)s=l[r],a.insertNode(s[0]);return this.editor.selection.setRangeAtEndOf(u[0]),this.editor.trigger("valuechanged")},e.prototype._convertEl=function(t){var e,i,n,r;return e=$(t),r=[],e.is(this.htmlTag)?(i=$("<p/>").append(e.html().replace("\n","<br/>")),r.push(i)):(n=!e.text()&&1===e.children().length&&e.children().is("br")?"\n":this.editor.formatter.clearHtml(e),i=$("<"+this.htmlTag+"/>").text(n),r.push(i)),r},e}(r),s=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.render=function(){var t,e,i,n,r;for(this._tpl='<div class="code-settings">\n  <div class="settings-field">\n    <select class="select-lang">\n      <option value="-1">'+this._t("selectLanguage")+"</option>\n    </select>\n  </div>\n</div>",this.langs=this.editor.opts.codeLanguages||[{name:"Bash",value:"bash"},{name:"C++",value:"c++"},{name:"C#",value:"cs"},{name:"CSS",value:"css"},{name:"Erlang",value:"erlang"},{name:"Less",value:"less"},{name:"Sass",value:"sass"},{name:"Diff",value:"diff"},{name:"CoffeeScript",value:"coffeescript"},{name:"HTML,XML",value:"html"},{name:"JSON",value:"json"},{name:"Java",value:"java"},{name:"JavaScript",value:"js"},{name:"Markdown",value:"markdown"},{name:"Objective C",value:"oc"},{name:"PHP",value:"php"},{name:"Perl",value:"parl"},{name:"Python",value:"python"},{name:"Ruby",value:"ruby"},{name:"SQL",value:"sql"}],this.el.addClass("code-popover").append(this._tpl),this.selectEl=this.el.find(".select-lang"),r=this.langs,e=0,n=r.length;n>e;e++)i=r[e],t=$("<option/>",{text:i.name,value:i.value}).appendTo(this.selectEl);return this.selectEl.on("change",function(t){return function(e){var i;return t.lang=t.selectEl.val(),i=t.target.hasClass("selected"),t.target.removeClass().removeAttr("data-lang"),-1!==t.lang&&t.target.attr("data-lang",t.lang),i?t.target.addClass("selected"):void 0}}(this)),this.editor.on("valuechanged",function(t){return function(e){return t.active?t.refresh():void 0}}(this))},e.prototype.show=function(){var t;return t=1<=arguments.length?P.call(arguments,0):[],e.__super__.show.apply(this,t),this.lang=this.target.attr("data-lang"),this.selectEl.val(null!=this.lang?this.lang:-1)},e}(C),N.Toolbar.addButton(o),y=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.name="link",e.prototype.icon="link",e.prototype.htmlTag="a",e.prototype.disableTag="pre",e.prototype.render=function(){var t;return t=1<=arguments.length?P.call(arguments,0):[],e.__super__.render.apply(this,t),this.popover=new b({button:this})},e.prototype.status=function(t){var e;return null!=t&&this.setDisabled(t.is(this.disableTag)),this.disabled?!0:null==t?this.active:(e=!0,!t.is(this.htmlTag)||t.is('[class^="simditor-"]')?(this.setActive(!1),e=!1):this.editor.selection.rangeAtEndOf(t)?(this.setActive(!0),e=!1):this.setActive(!0),e?this.popover.show(t):this.editor.util.isBlockNode(t)&&this.popover.hide(),this.active)},e.prototype.command=function(){var t,e,i,n,r,o,s,a,l,u;return a=this.editor.selection.getRange(),this.active?(i=$(a.commonAncestorContainer).closest("a"),u=document.createTextNode(i.text()),i.replaceWith(u),a.selectNode(u)):(l=a.startContainer,o=a.endContainer,r=this.editor.util.closestBlockEl(l),e=this.editor.util.closestBlockEl(o),t=$(a.extractContents()),s=this.editor.formatter.clearHtml(t.contents(),!1),i=$("<a/>",{href:"http://www.example.com",target:"_blank",text:s||this._t("linkText")}),r[0]===e[0]?a.insertNode(i[0]):(n=$("<p/>").append(i),a.insertNode(n[0])),a.selectNodeContents(i[0]),this.popover.one("popovershow",function(t){return function(){return s?(t.popover.urlEl.focus(),t.popover.urlEl[0].select()):(t.popover.textEl.focus(),t.popover.textEl[0].select())}}(this))),this.editor.selection.selectRange(a),this.editor.trigger("valuechanged")},e}(r),b=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.render=function(){var t;return t='<div class="link-settings">\n  <div class="settings-field">\n    <label>'+this._t("text")+'</label>\n    <input class="link-text" type="text"/>\n    <a class="btn-unlink" href="javascript:;" title="'+this._t("removeLink")+'" tabindex="-1"><span class="simditor-icon simditor-icon-unlink"></span></a>\n  </div>\n  <div class="settings-field">\n    <label>'+this._t("linkUrl")+'</label>\n    <input class="link-url" type="text"/>\n  </div>\n</div>',this.el.addClass("link-popover").append(t),this.textEl=this.el.find(".link-text"),this.urlEl=this.el.find(".link-url"),this.unlinkEl=this.el.find(".btn-unlink"),this.textEl.on("keyup",function(t){return function(e){return 13!==e.which?t.target.text(t.textEl.val()):void 0}}(this)),this.urlEl.on("keyup",function(t){return function(e){var i;if(13!==e.which)return i=t.urlEl.val(),!/https?:\/\/|^\//gi.test(i)&&i&&(i="http://"+i),t.target.attr("href",i)}}(this)),$([this.urlEl[0],this.textEl[0]]).on("keydown",function(t){return function(e){return 13===e.which||27===e.which||!e.shiftKey&&9===e.which&&$(e.target).hasClass("link-url")?(e.preventDefault(),setTimeout(function(){var e;return e=document.createRange(),t.editor.selection.setRangeAfter(t.target,e),t.hide(),t.editor.trigger("valuechanged")},0)):void 0}}(this)),this.unlinkEl.on("click",function(t){return function(e){var i,n;return n=document.createTextNode(t.target.text()),t.target.replaceWith(n),t.hide(),i=document.createRange(),t.editor.selection.setRangeAfter(n,i),t.editor.trigger("valuechanged")}}(this))},e.prototype.show=function(){var t;return t=1<=arguments.length?P.call(arguments,0):[],e.__super__.show.apply(this,t),this.textEl.val(this.target.text()),this.urlEl.val(this.target.attr("href"))},e}(C),N.Toolbar.addButton(y),c=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.name="image",e.prototype.icon="picture-o",e.prototype.htmlTag="img",e.prototype.disableTag="pre, table",e.prototype.defaultImage="",e.prototype.needFocus=!1,e.prototype._init=function(){var t,i,n,r;if(this.editor.opts.imageButton)if(Array.isArray(this.editor.opts.imageButton))for(this.menu=[],r=this.editor.opts.imageButton,i=0,n=r.length;n>i;i++)t=r[i],this.menu.push({name:t+"-image",text:this._t(t+"Image")});else this.menu=!1;else this.menu=null!=this.editor.uploader?[{name:"upload-image",text:this._t("uploadImage")},{name:"external-image",text:this._t("externalImage")}]:!1;return this.defaultImage=this.editor.opts.defaultImage,this.editor.body.on("click","img:not([data-non-image])",function(t){return function(e){var i,n;return i=$(e.currentTarget),n=document.createRange(),n.selectNode(i[0]),t.editor.selection.selectRange(n),t.editor.util.support.onselectionchange||t.editor.trigger("selectionchanged"),!1}}(this)),this.editor.body.on("mouseup","img:not([data-non-image])",function(t){return function(t){return!1}}(this)),this.editor.on("selectionchanged.image",function(t){return function(){var e,i,n;return n=t.editor.selection.getRange(),null!=n?(e=$(n.cloneContents()).contents(),1===e.length&&e.is("img:not([data-non-image])")?(i=$(n.startContainer).contents().eq(n.startOffset),t.popover.show(i)):t.popover.hide()):void 0}}(this)),this.editor.on("valuechanged.image",function(t){return function(){var e;return e=t.editor.wrapper.find(".simditor-image-loading"),e.length>0?e.each(function(e,i){var n,r,o;return r=$(i),n=r.data("img"),!(n&&n.parent().length>0)&&(r.remove(),n&&(o=n.data("file"),o&&(t.editor.uploader.cancel(o),t.editor.body.find("img.uploading").length<1)))?t.editor.uploader.trigger("uploadready",[o]):void 0}):void 0}}(this)),e.__super__._init.call(this)},e.prototype.render=function(){var t;return t=1<=arguments.length?P.call(arguments,0):[],e.__super__.render.apply(this,t),this.popover=new p({button:this}),"upload"===this.editor.opts.imageButton?this._initUploader(this.el):void 0},e.prototype.renderMenu=function(){return e.__super__.renderMenu.call(this),this._initUploader()},e.prototype._initUploader=function(t){var e,i;return null==t&&(t=this.menuEl.find(".menu-item-upload-image")),null==this.editor.uploader?void this.el.find(".btn-upload").remove():(e=null,i=function(i){return function(){return e&&e.remove(),e=$('<input type="file" title="'+i._t("uploadImage")+'" accept="image/*">').appendTo(t)}}(this),i(),t.on("click mousedown","input[type=file]",function(t){return function(t){return t.stopPropagation()}}(this)),t.on("change","input[type=file]",function(t){return function(n){return t.editor.inputManager.focused?(t.editor.uploader.upload(e,{inline:!0}),i()):(t.editor.one("focus",function(n){return t.editor.uploader.upload(e,{inline:!0}),i()}),t.editor.focus()),t.wrapper.removeClass("menu-on")}}(this)),this.editor.uploader.on("beforeupload",function(t){return function(e,i){var n;if(i.inline)return i.img?n=$(i.img):(n=t.createImage(i.name),i.img=n),n.addClass("uploading"),n.data("file",i),t.editor.uploader.readImageFile(i.obj,function(e){var i;if(n.hasClass("uploading"))return i=e?e.src:t.defaultImage,t.loadImage(n,i,function(){return t.popover.active?(t.popover.refresh(),t.popover.srcEl.val(t._t("uploading")).prop("disabled",!0)):void 0})})}}(this)),this.editor.uploader.on("uploadprogress",$.proxy(this.editor.util.throttle(function(t,e,i,n){var r,o,s;if(e.inline&&(o=e.img.data("mask")))return r=o.data("img"),r.hasClass("uploading")&&r.parent().length>0?(s=i/n,s=(100*s).toFixed(0),s>99&&(s=99),o.find(".progress").height(100-s+"%")):void o.remove()},500),this)),this.editor.uploader.on("uploadsuccess",function(t){return function(e,i,n){var r,o,s;if(i.inline&&(r=i.img,r.hasClass("uploading")&&r.parent().length>0)){if(r.removeData("file"),r.removeClass("uploading").removeClass("loading"),o=r.data("mask"),o&&o.remove(),r.removeData("mask"),"object"!=typeof n)try{n=$.parseJSON(n)}catch(a){e=a,n={success:!1}}return n.success===!1?(s=n.msg||t._t("uploadFailed"),alert(s),r.attr("src",t.defaultImage)):r.attr("src",n.file_path),t.popover.active&&(t.popover.srcEl.prop("disabled",!1),t.popover.srcEl.val(n.file_path)),t.editor.trigger("valuechanged"),t.editor.body.find("img.uploading").length<1?t.editor.uploader.trigger("uploadready",[i,n]):void 0}}}(this)),this.editor.uploader.on("uploaderror",function(t){return function(e,i,n){var r,o,s,a;if(i.inline&&"abort"!==n.statusText){if(n.responseText){try{a=$.parseJSON(n.responseText),s=a.msg}catch(l){e=l,s=t._t("uploadError")}alert(s)}if(r=i.img,r.hasClass("uploading")&&r.parent().length>0)return r.removeData("file"),r.removeClass("uploading").removeClass("loading"),o=r.data("mask"),o&&o.remove(),r.removeData("mask"),r.attr("src",t.defaultImage),t.popover.active&&(t.popover.srcEl.prop("disabled",!1),t.popover.srcEl.val(t.defaultImage)),t.editor.trigger("valuechanged"),t.editor.body.find("img.uploading").length<1?t.editor.uploader.trigger("uploadready",[i,a]):void 0}}}(this)))},e.prototype.status=function(t){return null!=t&&this.setDisabled(t.is(this.disableTag)),this.disabled?!0:void 0},e.prototype.loadImage=function(t,e,i){var n,r,o;return o=function(e){return function(){var i,r;return i=t.offset(),r=e.editor.wrapper.offset(),n.css({top:i.top-r.top,left:i.left-r.left,width:t.width(),height:t.height()}).show()}}(this),t.addClass("loading"),n=t.data("mask"),n||(n=$('<div class="simditor-image-loading"><div class="progress"></div></div>').hide().appendTo(this.editor.wrapper),o(),t.data("mask",n),n.data("img",t)),r=new Image,r.onload=function(s){return function(){var a,l;if(t.hasClass("loading")||t.hasClass("uploading"))return l=r.width,a=r.height,t.attr({src:e,"data-image-size":l+","+a}).removeClass("loading"),t.hasClass("uploading")?(s.editor.util.reflow(s.editor.body),o()):(n.remove(),t.removeData("mask")),i(r)}}(this),r.onerror=function(e){return function(){return i(!1),n.remove(),t.removeData("mask").removeClass("loading")}}(this),r.src=e},e.prototype.createImage=function(t){var e,i,n,r;return null==t&&(t="Image"),this.editor.inputManager.focused||this.editor.focus(),r=this.editor.selection.getRange(),r.deleteContents(),e=this.editor.util.closestBlockEl(),e.is("p")&&!this.editor.util.isEmptyNode(e)&&(e=$("<p/>").append(this.editor.util.phBr).insertAfter(e),this.editor.selection.setRangeAtStartOf(e,r)),i=$("<img/>").attr("alt",t),r.insertNode(i[0]),n=e.next("p"),n.length>0||(n=$("<p/>").append(this.editor.util.phBr).insertAfter(e)),this.editor.selection.setRangeAtStartOf(n),i},e.prototype.command=function(t){var e;return e=this.createImage(),this.loadImage(e,t||this.defaultImage,function(t){return function(){return t.editor.trigger("valuechanged"),t.editor.util.reflow(e),e.click(),t.popover.one("popovershow",function(){return t.popover.srcEl.focus(),t.popover.srcEl[0].select()})}}(this))},e}(r),p=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.offset={top:6,left:-4},e.prototype.render=function(){var t;return t='<div class="link-settings">\n  <div class="settings-field">\n    <label>'+this._t("imageUrl")+'</label>\n    <input class="image-src" type="text" tabindex="1" />\n    <a class="btn-upload" href="javascript:;" title="'+this._t("uploadImage")+'" tabindex="-1">\n      <span class="simditor-icon simditor-icon-upload"></span>\n    </a>\n  </div>\n  <div class=\'settings-field\'>\n    <label>'+this._t("imageAlt")+'</label>\n    <input class="image-alt" id="image-alt" type="text" tabindex="1" />\n  </div>\n  <div class="settings-field">\n    <label>'+this._t("imageSize")+'</label>\n    <input class="image-size" id="image-width" type="text" tabindex="2" />\n    <span class="times">×</span>\n    <input class="image-size" id="image-height" type="text" tabindex="3" />\n    <a class="btn-restore" href="javascript:;" title="'+this._t("restoreImageSize")+'" tabindex="-1">\n      <span class="simditor-icon simditor-icon-undo"></span>\n    </a>\n  </div>\n</div>',
this.el.addClass("image-popover").append(t),this.srcEl=this.el.find(".image-src"),this.widthEl=this.el.find("#image-width"),this.heightEl=this.el.find("#image-height"),this.altEl=this.el.find("#image-alt"),this.srcEl.on("keydown",function(t){return function(e){return 13!==e.which||t.target.hasClass("uploading")?void 0:(e.preventDefault(),t.button.editor.body.focus(),t.button.editor.selection.setRangeAfter(t.target),t.hide())}}(this)),this.srcEl.on("blur",function(t){return function(e){return t._loadImage(t.srcEl.val())}}(this)),this.el.find(".image-size").on("blur",function(t){return function(e){return t._resizeImg($(e.currentTarget)),t.el.data("popover").refresh()}}(this)),this.el.find(".image-size").on("keyup",function(t){return function(e){var i;return i=$(e.currentTarget),13!==e.which&&27!==e.which&&9!==e.which?t._resizeImg(i,!0):void 0}}(this)),this.el.find(".image-size").on("keydown",function(t){return function(e){var i;return i=$(e.currentTarget),13===e.which||27===e.which?(e.preventDefault(),13===e.which?t._resizeImg(i):t._restoreImg(),t.button.editor.body.focus(),t.button.editor.selection.setRangeAfter(t.target),t.hide()):9===e.which?t.el.data("popover").refresh():void 0}}(this)),this.altEl.on("keydown",function(t){return function(e){return 13===e.which?(e.preventDefault(),t.button.editor.body.focus(),t.button.editor.selection.setRangeAfter(t.target),t.hide()):void 0}}(this)),this.altEl.on("keyup",function(t){return function(e){return 13!==e.which&&27!==e.which&&9!==e.which?(t.alt=t.altEl.val(),t.target.attr("alt",t.alt)):void 0}}(this)),this.el.find(".btn-restore").on("click",function(t){return function(e){return t._restoreImg(),t.el.data("popover").refresh()}}(this)),this.editor.on("valuechanged",function(t){return function(e){return t.active?t.refresh():void 0}}(this)),this._initUploader()},e.prototype._initUploader=function(){var t,e;return t=this.el.find(".btn-upload"),null==this.editor.uploader?void t.remove():(e=function(e){return function(){return e.input&&e.input.remove(),e.input=$('<input type="file" title="'+e._t("uploadImage")+'" accept="image/*">').appendTo(t)}}(this),e(),this.el.on("click mousedown","input[type=file]",function(t){return function(t){return t.stopPropagation()}}(this)),this.el.on("change","input[type=file]",function(t){return function(i){return t.editor.uploader.upload(t.input,{inline:!0,img:t.target}),e()}}(this)))},e.prototype._resizeImg=function(t,e){var i,n,r;return null==e&&(e=!1),n=1*t.val(),$.isNumeric(n)||0>n?(t.is(this.widthEl)?(i=this.height*n/this.width,this.heightEl.val(i)):(r=this.width*n/this.height,this.widthEl.val(r)),e||this.target.attr({width:r||n,height:i||n}),this.editor.trigger("valuechanged")):void 0},e.prototype._restoreImg=function(){var t,e;return e=(null!=(t=this.target.data("image-size"))?t.split(","):void 0)||[this.width,this.height],this.target.attr({width:1*e[0],height:1*e[1]}),this.widthEl.val(e[0]),this.heightEl.val(e[1]),this.editor.trigger("valuechanged")},e.prototype._loadImage=function(t,e){return/^data:image/.test(t)&&!this.editor.uploader?void(e&&e(!1)):this.button.loadImage(this.target,t,function(i){return function(n){var r;if(n)return i.active&&(i.width=n.width,i.height=n.height,i.widthEl.val(i.width),i.heightEl.val(i.height),i.target.removeAttr("width").removeAttr("height")),/^data:image/.test(t)?(r=i.editor.util.dataURLtoBlob(t),r.name="Base64 Image.png",i.editor.uploader.upload(r,{inline:!0,img:i.target})):i.editor.trigger("valuechanged"),e?e(n):void 0}}(this))},e.prototype.show=function(){var t,i;return i=1<=arguments.length?P.call(arguments,0):[],e.__super__.show.apply(this,i),t=this.target,this.width=t.width(),this.height=t.height(),this.alt=t.attr("alt"),t.hasClass("uploading")?this.srcEl.val(this._t("uploading")).prop("disabled",!0):(this.srcEl.val(t.attr("src")).prop("disabled",!1),this.widthEl.val(this.width),this.heightEl.val(this.height),this.altEl.val(this.alt))},e}(C),N.Toolbar.addButton(c),f=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.name="indent",e.prototype.icon="indent",e.prototype._init=function(){return this.title=this._t(this.name)+" (Tab)",e.__super__._init.call(this)},e.prototype.status=function(t){return!0},e.prototype.command=function(){return this.editor.indentation.indent()},e}(r),N.Toolbar.addButton(f),k=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.name="outdent",e.prototype.icon="outdent",e.prototype._init=function(){return this.title=this._t(this.name)+" (Shift + Tab)",e.__super__._init.call(this)},e.prototype.status=function(t){return!0},e.prototype.command=function(){return this.editor.indentation.indent(!0)},e}(r),N.Toolbar.addButton(k),h=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.name="hr",e.prototype.icon="minus",e.prototype.htmlTag="hr",e.prototype.status=function(t){return!0},e.prototype.command=function(){var t,e,i,n;return n=this.editor.util.furthestBlockEl(),i=n.next(),i.length>0?this.editor.selection.save():e=$("<p/>").append(this.editor.util.phBr),t=$("<hr/>").insertAfter(n),e?(e.insertAfter(t),this.editor.selection.setRangeAtStartOf(e)):this.editor.selection.restore(),this.editor.trigger("valuechanged")},e}(r),N.Toolbar.addButton(h),S=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.name="table",e.prototype.icon="table",e.prototype.htmlTag="table",e.prototype.disableTag="pre, li, blockquote",e.prototype.menu=!0,e.prototype._init=function(){return e.__super__._init.call(this),$.merge(this.editor.formatter._allowedTags,["thead","th","tbody","tr","td","colgroup","col"]),$.extend(this.editor.formatter._allowedAttributes,{td:["rowspan","colspan","style"],col:["width"]}),this._initShortcuts(),this.editor.on("decorate",function(t){return function(e,i){return i.find("table").each(function(e,i){return t.decorate($(i))})}}(this)),this.editor.on("undecorate",function(t){return function(e,i){return i.find("table").each(function(e,i){return t.undecorate($(i))})}}(this)),this.editor.on("selectionchanged.table",function(t){return function(e){var i,n;return t.editor.body.find(".simditor-table td, .simditor-table th").removeClass("active"),n=t.editor.selection.getRange(),null!=n?(i=$(n.commonAncestorContainer),n.collapsed&&i.is(".simditor-table")&&(i=i.find(t.editor.selection.rangeAtStartOf(i)?"th:first":"td:last"),t.editor.selection.setRangeAtEndOf(i)),i.closest("td, th",t.editor.body).addClass("active")):void 0}}(this)),this.editor.on("blur.table",function(t){return function(e){return t.editor.body.find(".simditor-table td, .simditor-table th").removeClass("active")}}(this)),this.editor.inputManager.addKeystrokeHandler("38","td",function(t){return function(e,i){return t._tdNav(i,"up"),!0}}(this)),this.editor.inputManager.addKeystrokeHandler("38","th",function(t){return function(e,i){return t._tdNav(i,"up"),!0}}(this)),this.editor.inputManager.addKeystrokeHandler("40","td",function(t){return function(e,i){return t._tdNav(i,"down"),!0}}(this)),this.editor.inputManager.addKeystrokeHandler("40","th",function(t){return function(e,i){return t._tdNav(i,"down"),!0}}(this))},e.prototype._tdNav=function(t,e){var i,n,r,o,s,a,l;return null==e&&(e="up"),r="up"===e?"prev":"next",l="up"===e?["tbody","thead"]:["thead","tbody"],a=l[0],o=l[1],n=t.parent("tr"),i=this["_"+r+"Row"](n),i.length>0?(s=n.find("td, th").index(t),this.editor.selection.setRangeAtEndOf(i.find("td, th").eq(s))):!0},e.prototype._nextRow=function(t){var e;return e=t.next("tr"),e.length<1&&t.parent("thead").length>0&&(e=t.parent("thead").next("tbody").find("tr:first")),e},e.prototype._prevRow=function(t){var e;return e=t.prev("tr"),e.length<1&&t.parent("tbody").length>0&&(e=t.parent("tbody").prev("thead").find("tr")),e},e.prototype.initResize=function(t){var e,i,n;return n=t.parent(".simditor-table"),e=t.find("colgroup"),e.length<1&&(e=$("<colgroup/>").prependTo(t),t.find("thead tr th").each(function(t){return function(t,i){var n;return n=$("<col/>").appendTo(e)}}(this)),this.refreshTableWidth(t)),i=$('<div class="simditor-resize-handle" contenteditable="false"></div>').appendTo(n),n.on("mousemove","td, th",function(t){return function(t){var r,o,s,a,l,u;if(!n.hasClass("resizing"))return o=$(t.currentTarget),u=t.pageX-$(t.currentTarget).offset().left,5>u&&o.prev().length>0&&(o=o.prev()),o.next("td, th").length<1?void i.hide():(null!=(a=i.data("td"))?a.is(o):void 0)?void i.show():(s=o.parent().find("td, th").index(o),r=e.find("col").eq(s),(null!=(l=i.data("col"))?l.is(r):void 0)?void i.show():i.css("left",o.position().left+o.outerWidth()-5).data("td",o).data("col",r).show())}}(this)),n.on("mouseleave",function(t){return function(t){return i.hide()}}(this)),n.on("mousedown",".simditor-resize-handle",function(t){return function(t){var e,i,r,o,s,a,l,u,d,h,c;return e=$(t.currentTarget),r=e.data("td"),i=e.data("col"),s=r.next("td, th"),o=i.next("col"),h=t.pageX,u=1*r.outerWidth(),d=1*s.outerWidth(),l=parseFloat(e.css("left")),c=r.closest("table").width(),a=50,$(document).on("mousemove.simditor-resize-table",function(t){var n,r,s;return n=t.pageX-h,r=u+n,s=d-n,a>r?(r=a,n=a-u,s=d-n):a>s&&(s=a,n=d-a,r=u+n),i.attr("width",r/c*100+"%"),o.attr("width",s/c*100+"%"),e.css("left",l+n)}),$(document).one("mouseup.simditor-resize-table",function(t){return $(document).off(".simditor-resize-table"),n.removeClass("resizing")}),n.addClass("resizing"),!1}}(this))},e.prototype._initShortcuts=function(){return this.editor.inputManager.addShortcut("ctrl+alt+up",function(t){return function(e){return t.editMenu.find(".menu-item[data-param=insertRowAbove]").click(),!1}}(this)),this.editor.inputManager.addShortcut("ctrl+alt+down",function(t){return function(e){return t.editMenu.find(".menu-item[data-param=insertRowBelow]").click(),!1}}(this)),this.editor.inputManager.addShortcut("ctrl+alt+left",function(t){return function(e){return t.editMenu.find(".menu-item[data-param=insertColLeft]").click(),!1}}(this)),this.editor.inputManager.addShortcut("ctrl+alt+right",function(t){return function(e){return t.editMenu.find(".menu-item[data-param=insertColRight]").click(),!1}}(this))},e.prototype.decorate=function(t){return t.parent(".simditor-table").length>0&&this.undecorate(t),t.wrap('<div class="simditor-table"></div>'),this.initResize(t),t.parent()},e.prototype.undecorate=function(t){return t.parent(".simditor-table").length>0?t.parent().replaceWith(t):void 0},e.prototype.renderMenu=function(){var t;return $('<div class="menu-create-table">\n</div>\n<div class="menu-edit-table">\n  <ul>\n    <li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;" data-param="deleteRow"><span>'+this._t("deleteRow")+'</span></a></li>\n    <li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;" data-param="insertRowAbove"><span>'+this._t("insertRowAbove")+' ( Ctrl + Alt + ↑ )</span></a></li>\n    <li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;" data-param="insertRowBelow"><span>'+this._t("insertRowBelow")+' ( Ctrl + Alt + ↓ )</span></a></li>\n    <li><span class="separator"></span></li>\n    <li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;" data-param="deleteCol"><span>'+this._t("deleteColumn")+'</span></a></li>\n    <li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;" data-param="insertColLeft"><span>'+this._t("insertColumnLeft")+' ( Ctrl + Alt + ← )</span></a></li>\n    <li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;" data-param="insertColRight"><span>'+this._t("insertColumnRight")+' ( Ctrl + Alt + → )</span></a></li>\n    <li><span class="separator"></span></li>\n    <li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;" data-param="deleteTable"><span>'+this._t("deleteTable")+"</span></a></li>\n  </ul>\n</div>").appendTo(this.menuWrapper),this.createMenu=this.menuWrapper.find(".menu-create-table"),this.editMenu=this.menuWrapper.find(".menu-edit-table"),t=this.createTable(6,6).appendTo(this.createMenu),this.createMenu.on("mouseenter","td, th",function(e){return function(i){var n,r,o,s;return e.createMenu.find("td, th").removeClass("selected"),n=$(i.currentTarget),r=n.parent(),s=r.find("td, th").index(n)+1,o=r.prevAll("tr").addBack(),r.parent().is("tbody")&&(o=o.add(t.find("thead tr"))),o.find("td:lt("+s+"), th:lt("+s+")").addClass("selected")}}(this)),this.createMenu.on("mouseleave",function(t){return function(t){return $(t.currentTarget).find("td, th").removeClass("selected")}}(this)),this.createMenu.on("mousedown","td, th",function(e){return function(i){var n,r,o,s,a;return e.wrapper.removeClass("menu-on"),e.editor.inputManager.focused?(r=$(i.currentTarget),o=r.parent(),s=o.find("td").index(r)+1,a=o.prevAll("tr").length+1,o.parent().is("tbody")&&(a+=1),t=e.createTable(a,s,!0),n=e.editor.util.closestBlockEl(),e.editor.util.isEmptyNode(n)?n.replaceWith(t):n.after(t),e.decorate(t),e.editor.selection.setRangeAtStartOf(t.find("th:first")),e.editor.trigger("valuechanged"),!1):void 0}}(this))},e.prototype.createTable=function(t,e,i){var n,r,o,s,a,l,u,d,h,c,p;for(n=$("<table/>"),s=$("<thead/>").appendTo(n),r=$("<tbody/>").appendTo(n),h=u=0,c=t;c>=0?c>u:u>c;h=c>=0?++u:--u)for(a=$("<tr/>"),a.appendTo(0===h?s:r),l=d=0,p=e;p>=0?p>d:d>p;l=p>=0?++d:--d)o=$(0===h?"<th/>":"<td/>").appendTo(a),i&&o.append(this.editor.util.phBr);return n},e.prototype.refreshTableWidth=function(t){var e,i;return i=t.width(),e=t.find("col"),t.find("thead tr th").each(function(t){return function(t,n){var r;return r=e.eq(t),r.attr("width",$(n).outerWidth()/i*100+"%")}}(this))},e.prototype.setActive=function(t){return e.__super__.setActive.call(this,t),t?(this.createMenu.hide(),this.editMenu.show()):(this.createMenu.show(),this.editMenu.hide())},e.prototype._changeCellTag=function(t,e){return t.find("td, th").each(function(t){return function(t,i){var n;return n=$(i),n.replaceWith("<"+e+">"+n.html()+"</"+e+">")}}(this))},e.prototype.deleteRow=function(t){var e,i,n;return i=t.parent("tr"),i.closest("table").find("tr").length<1?this.deleteTable(t):(e=this._nextRow(i),e.length>0||(e=this._prevRow(i)),n=i.find("td, th").index(t),i.parent().is("thead")&&(e.appendTo(i.parent()),this._changeCellTag(e,"th")),i.remove(),this.editor.selection.setRangeAtEndOf(e.find("td, th").eq(n)))},e.prototype.insertRow=function(t,e){var i,n,r,o,s,a,l,u,d;for(null==e&&(e="after"),r=t.parent("tr"),n=r.closest("table"),s=0,n.find("tr").each(function(t){return function(t,e){return s=Math.max(s,$(e).find("td").length)}}(this)),l=r.find("td, th").index(t),i=$("<tr/>"),o="td","after"===e&&r.parent().is("thead")?r.parent().next("tbody").prepend(i):"before"===e&&r.parent().is("thead")?(r.before(i),r.parent().next("tbody").prepend(r),this._changeCellTag(r,"td"),o="th"):r[e](i),a=u=1,d=s;d>=1?d>=u:u>=d;a=d>=1?++u:--u)$("<"+o+"/>").append(this.editor.util.phBr).appendTo(i);return this.editor.selection.setRangeAtStartOf(i.find("td, th").eq(l))},e.prototype.deleteCol=function(t){var e,i,n,r;return n=t.parent("tr"),n.closest("table").find("tr").length<1&&t.siblings("td, th").length<1?this.deleteTable(t):(r=n.find("td, th").index(t),e=t.next("td, th"),e.length>0||(e=n.prev("td, th")),i=n.closest("table"),i.find("col").eq(r).remove(),i.find("tr").each(function(t){return function(t,e){return $(e).find("td, th").eq(r).remove()}}(this)),this.refreshTableWidth(i),this.editor.selection.setRangeAtEndOf(e))},e.prototype.insertCol=function(t,e){var i,n,r,o,s,a,l,u;return null==e&&(e="after"),s=t.parent("tr"),a=s.find("td, th").index(t),o=t.closest("table"),i=o.find("col").eq(a),o.find("tr").each(function(t){return function(i,n){var r,o;return o=$(n).parent().is("thead")?"th":"td",r=$("<"+o+"/>").append(t.editor.util.phBr),$(n).find("td, th").eq(a)[e](r)}}(this)),n=$("<col/>"),i[e](n),l=o.width(),u=Math.max(parseFloat(i.attr("width"))/2,50/l*100),i.attr("width",u+"%"),n.attr("width",u+"%"),this.refreshTableWidth(o),r="after"===e?t.next("td, th"):t.prev("td, th"),this.editor.selection.setRangeAtStartOf(r)},e.prototype.deleteTable=function(t){var e,i;return i=t.closest(".simditor-table"),e=i.next("p"),i.remove(),e.length>0?this.editor.selection.setRangeAtStartOf(e):void 0},e.prototype.command=function(t){var e,i;if(i=this.editor.selection.getRange(),e=$(i.commonAncestorContainer).closest("td, th"),e.length>0){if("deleteRow"===t)this.deleteRow(e);else if("insertRowAbove"===t)this.insertRow(e,"before");else if("insertRowBelow"===t)this.insertRow(e);else if("deleteCol"===t)this.deleteCol(e);else if("insertColLeft"===t)this.insertCol(e,"before");else if("insertColRight"===t)this.insertCol(e);else{if("deleteTable"!==t)return;this.deleteTable(e)}return this.editor.trigger("valuechanged")}},e}(r),N.Toolbar.addButton(S),R=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.name="strikethrough",e.prototype.icon="strikethrough",e.prototype.htmlTag="strike",e.prototype.disableTag="pre",e.prototype.status=function(t){var e;return null!=t&&this.setDisabled(t.is(this.disableTag)),this.disabled?!0:(e=document.queryCommandState("strikethrough")===!0,this.setActive(e),e)},e.prototype.command=function(){return document.execCommand("strikethrough"),this.editor.util.support.oninput||this.editor.trigger("valuechanged"),$(document).trigger("selectionchange")},e}(r),N.Toolbar.addButton(R),t=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.name="alignment",e.prototype.icon="align-left",e.prototype.htmlTag="p, h1, h2, h3, h4",e.prototype._init=function(){return this.menu=[{name:"left",text:this._t("alignLeft"),icon:"align-left",param:"left"},{name:"center",text:this._t("alignCenter"),icon:"align-center",param:"center"},{name:"right",text:this._t("alignRight"),icon:"align-right",param:"right"}],e.__super__._init.call(this)},e.prototype.setActive=function(t,i){return null==i&&(i="left"),"left"===i?e.__super__.setActive.call(this,!1):e.__super__.setActive.call(this,t),this.el.removeClass("align-left align-center align-right"),t&&this.el.addClass("align-"+i),this.setIcon("align-"+i),this.menuEl.find(".menu-item").show().end().find(".menu-item-"+i).hide()},e.prototype.status=function(t){if(null==t)return!0;if(this.editor.util.isBlockNode(t))return this.setDisabled(!t.is(this.htmlTag)),this.disabled?(this.setActive(!1),!0):(this.setActive(!0,t.data("align")),this.active)},e.prototype.command=function(t){var e,i,n,r,o,s,a,l,u,d;if(["left","center","right"].indexOf(t)<0)throw"invalid "+t;for(l=this.editor.selection.getRange(),d=l.startContainer,o=l.endContainer,n=this.editor.util.closestBlockEl(d),i=this.editor.util.closestBlockEl(o),this.editor.selection.save(),e=n.is(i)?n:n.nextUntil(i).addBack().add(i),u=e.filter(this.htmlTag),s=0,a=u.length;a>s;s++)r=u[s],$(r).attr("data-align",t).data("align",t);return this.editor.selection.restore(),this.editor.trigger("valuechanged")},e}(r),N.Toolbar.addButton(t),e=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.name="background",e.prototype.icon="background",e.prototype.htmlTag="table",e.prototype.disableTag="pre, p",e.prototype.menu=!0,e.prototype.render=function(){var t;return t=1<=arguments.length?P.call(arguments,0):[],e.__super__.render.apply(this,t)},e.prototype.renderMenu=function(){return $('<ul class="color-list">\n  <li><a href="javascript:;" class="font-color font-color-1" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-2" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-3" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-4" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-5" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-6" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-7" data-color=""></a></li>\n  <li><a href="javascript:;" class="font-color font-color-8" data-color="" style="border: 1px solid #CCC;"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-default" data-color=""></a></li>\n</ul>').appendTo(this.menuWrapper),this.menuWrapper.on("mousedown",".color-list",function(t){return!1}),this.menuWrapper.on("click",".font-color",function(t){return function(e){var i,n,r,o,s,a,l;if(a=t.editor.selection.getRange(),i=$(a.commonAncestorContainer),(o=function(){var t;if(0!==i.length)return"TD"===(t=i[0].nodeName)||"TR"===t?i:(i=i.parent(),o())})()){if(t.wrapper.removeClass("menu-on"),n=$(e.currentTarget),n.hasClass("font-color-default")){if(r=t.editor.body.find("p, li"),!(r.length>0))return;l=window.getComputedStyle(r[0],null).getPropertyValue("color"),s=t._convertRgbToHex(l)}else l=window.getComputedStyle(n[0],null).getPropertyValue("background-color"),s=t._convertRgbToHex(l);if(s)return i.css("background-color",s),t.editor.setValue(t.editor.body.html()),t.editor.trigger("valuechanged")}}}(this))},e.prototype._convertRgbToHex=function(t){var e,i,n;return i=/rgb\((\d+),\s?(\d+),\s?(\d+)\)/g,(e=i.exec(t))?(n=function(t,e,i){var n;return n=function(t){var e;return e=t.toString(16),1===e.length?"0"+e:e},"#"+n(t)+n(e)+n(i)})(1*e[1],1*e[2],1*e[3]):""},e}(r),N.Toolbar.addButton(e),u=function(t){function e(){this.isExpand=!1,e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype._init=function(){return this.shortcut="esc",e.__super__._init.apply(this,arguments),this.setIcon("expand")},e.prototype.name="fullscreen",e.prototype.title="full-screen",e.prototype.needFocus=!1,e.prototype.saveStatus=function(){var t,e,i,n;return e=this.editor.el,n=this.editor.wrapper,i=this.editor.toolbar,t=this.editor.body,this.cssStatus={el:{position:e.css("position"),left:e.css("left"),right:e.css("right"),top:e.css("top"),bottom:e.css("bottom"),"z-index":e.css("z-index")},wrapper:n.css("height"),toolbar:{wrapper:{width:i.wrapper.css("width")}},body:{maxHeight:t.css("maxHeight"),overflow:t.css("overflow")}}},e.prototype.setIcon=function(t){return this.el.find("span").removeClass().addClass("fa fa-"+t)},e.prototype.resetStatus=function(){return this.editor.el.css(this.cssStatus.el),this.editor.wrapper.css(this.cssStatus.wrapper),this.editor.toolbar.wrapper.css(this.cssStatus.toolbar.wrapper),this.editor.body.css(this.cssStatus.body)},e.prototype.doFullScreen=function(){var t,e;return this.editor.el.css("position","fixed").css("left","0px").css("right","0px").css("top","0px").css("bottom","0px").css("z-index",1e3),this.editor.wrapper.css("height","100%"),this.editor.toolbar.wrapper.css("width","100%"),t=this.editor.toolbar.wrapper.height(),e=this.editor.wrapper.height(),this.editor.body.css("maxHeight",e-t+"px").css("overflow","auto")},e.prototype.command=function(){return this.isExpand?(this.setIcon("expand"),this.resetStatus(),void(this.isExpand=!1)):(this.setIcon("compress"),this.saveStatus(),this.isExpand=!0,this.doFullScreen())},e}(N.Button),N.Toolbar.addButton(u),d=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.name="html",e.prototype.icon="html5",e.prototype.needFocus=!1,e.prototype._init=function(){return e.__super__._init.call(this),this.editor.textarea.on("focus",function(t){return function(e){return t.editor.el.addClass("focus").removeClass("error")}}(this)),this.editor.textarea.on("blur",function(t){return function(e){return t.editor.el.removeClass("focus"),t.editor.setValue(t.editor.textarea.val()),t.editor.trigger("valuechanged")}}(this)),this.editor.textarea.on("input",function(t){return function(e){return t._resizeTextarea()}}(this))},e.prototype.status=function(t){return!0},e.prototype.command=function(){var t,e,i,n;for(this.editor.blur(),this.editor.el.toggleClass("simditor-html"),this.editor.htmlMode=this.editor.el.hasClass("simditor-html"),this.editor.htmlMode&&(this.editor.hidePopover(),this.editor.textarea.val(this.beautifyHTML(this.editor.textarea.val())),this._resizeTextarea()),n=this.editor.toolbar.buttons,e=0,i=n.length;i>e;e++)t=n[e],"html"===t.name?t.setActive(this.editor.htmlMode):t.setDisabled(this.editor.htmlMode);return null},e.prototype.beautifyHTML=function(){var t;return t=1<=arguments.length?P.call(arguments,0):[],html_beautify.apply(null,t)},e.prototype._resizeTextarea=function(){return this._textareaPadding||(this._textareaPadding=this.editor.textarea.innerHeight()-this.editor.textarea.height()),this.editor.textarea.height(0).height(this.editor.textarea[0].scrollHeight-this._textareaPadding)},e}(N.Button),N.Toolbar.addButton(d),x=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.name="map",e.prototype.icon="map",e.prototype.title="插入百度地图",e.prototype.needFocus=!1,e.prototype.generate_template=function(){var t,e;return t=Math.random().toString().substr(2,10),e='<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">\n  <div class="modal-dialog modal-lg">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n            <span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title">插入百度地图</h4>\n      </div>\n      <div class="modal-body">\n        <div class="row">\n            <form name="myForm" class="form-horizontal">\n            <div class="form-group col-xs-12">\n                <label class="col-xs-2 control-label">地址</label>\n                <div class="col-xs-10">\n                    <div class="input-group">\n                        <input type="text" class="form-control input-address"\n                            placeholder="地输入地址后点击搜索(或按下回车)能够自动定位，还可以移动小红点手动调整位置">\n                        <span class="input-group-addon btn btn-success btn-search" style="color:#FFF">\n                            <i class="fa fa-search"></i>搜索</span>\n                    </div>\n                    <p class="help-block"></p>\n                </div>\n            </div>\n            <div class="form-group col-xs-12">\n                <label class="col-xs-2 control-label">宽度</label>\n                <div class="col-xs-4">\n                    <input class="form-control input-width" type="text" placeholder="地图宽度" value="600">\n                </div>\n                <label class="col-xs-2 control-label">高度</label>\n                <div class="col-xs-4">\n                    <input class="form-control input-height" type="text" placeholder="地图高度" value="400">\n                </div>\n            </div>\n            <div class="form-group col-xs-12">\n                <div class="col-xs-10 col-xs-push-2">\n                    <div id="'+t+'" style="height: 400px"></div>\n                    <div style="margin:10px 0px 0px 0px">\n                      <p>鼠标拖拽小红点到你想要的位置，鼠标滚轮可以缩放，鼠标按住可以平移，输入完成请点击插入。</p>\n                    </div>\n                </div>\n            </div>\n            </form>\n        </div>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-success btn-insert" title="图片地图就是一张静态图片">插入图片地图</button>\n        <button type="button" class="btn btn-primary btn-dynamic" title="动态地图允许用户动态操作地图">插入动态地图</button>\n        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>\n      </div>\n    </div>\n  </div>\n</div>',[t,e]},e.prototype.command=function(){var t,e,i;return e=this.generate_template(),t=e[0],i=e[1],this.modal=$(i).prependTo("body"),this.input_address=this.modal.find(".input-address"),this.input_width=this.modal.find(".input-width"),this.input_height=this.modal.find(".input-height"),this.btn_insert=this.modal.find(".btn-insert"),this.btn_search=this.modal.find(".btn-search"),this.btn_dynamic=this.modal.find(".btn-dynamic"),this.modal.modal({backdrop:"static",keyboard:!1}),this.modal.on("shown.bs.modal",function(e){return function(i){return e.input_address.bind("input",function(){return e.address=e.input_address.val(),"function"==typeof e.search?e.search():void 0}),e.btn_search.click(function(){return e.address=e.input_address.val(),"function"==typeof e.search?e.search():void 0}),e.btn_insert.click(function(){return"function"==typeof e.insert_map?e.insert_map():void 0}),e.btn_dynamic.click(function(){var t;return"function"==typeof e.insert_map?e.insert_map(t=!0):void 0}),e.init_map(t)}}(this)),this.modal.on("hidden.bs.modal",function(t){return function(e){var i;return null!=(i=t.modal)?i.remove():void 0}}(this))},e.prototype.init_map=function(t){var e;return this.lat="31.14907",this.lng="121.316573",this.zoom="15",e="http://api.map.baidu.com/getscript?v=2.0&ak=z6ByGv9ZLALtjHOGVoGXGGx5",$.getScript(e,function(e){return function(){var i,n,r,o,s;return n=new window.BMap.Map($("#"+t)[0]),s=new window.BMap.Point(e.lng,e.lat),r=new window.BMap.Marker(s),n.addControl(new BMap.NavigationControl),n.centerAndZoom(s,e.zoom),n.enableScrollWheelZoom(),n.addOverlay(r),r.enableDragging(),r.addEventListener("dragend",function(t){return s=t.point,n.panTo(s),e.lat=s.lat,e.lng=s.lng}),o={onSearchComplete:function(t){var i;try{s=t.getPoi(0).point}catch(o){return void(i=o)}return n.centerAndZoom(s,e.zoom),r.setPosition(s),e.lat=s.lat,e.lng=s.lng}},i=new BMap.LocalSearch(n,o),e.search=function(){return e.address?i.search(e.address):void 0}}}(this))},e.prototype.insert_map=function(t){var e,i,n,r,o;return null==t&&(t=!1),this.address=this.input_address.val(),o=this.input_width.val()||"600",e=this.input_height.val()||"400",n=this.lng+","+this.lat,r="center="+n+"&zoom=15&width="+o+"&height="+e+"&markers="+n,i='<p><img class="simditor-map-img" src="http://api.map.baidu.com/staticimage?'+r+'" alt="'+(this.address||"")+'"></p>',t&&(i='<p>\n    <iframe class="simditor-map-iframe" src="/site_media/static/ueditor/dialogs/map/show.html#'+r+'"\n        frameborder="0" width="'+o+'" height="'+e+'"></iframe>\n</p>'),this.editor.setValue(this.editor.getValue()+i),this.editor.trigger("valuechanged"),this.modal.modal("hide")},e}(r),N.Toolbar.addButton(x),A=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.name="qiniu",e.prototype.icon="picture-o",e.prototype.title="插入图片",e.prototype.needFocus=!1,e.prototype.generate_template=function(){var t,e,i;return e=Math.random().toString().substr(2,10),i='<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">\n  <div class="modal-dialog" style="width:655px">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n            <span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title">插入图片</h4>\n      </div>\n      <div class="modal-body">\n        <div class="row">\n            <div class="form-group col-xs-12">\n                <div class="col-xs-12">\n                    <div class="col-xs-6" style="padding-left:5px;">\n                        <a class="btn btn-success" id="'+e+'" style="width:108px;">\n                            <i class="glyphicon glyphicon-plus"></i>上传图片\n                        </a>\n                    </div>\n                    <div class="col-xs-6 progress-wrap" style="display:none">\n                        <div class="progress progress-striped active">\n                            <div class="progress-bar progress-bar-success" style="width:5%"></div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class="form-group col-xs-12">\n                <div class="col-xs-12 thumbnails">\n                    <!-- repeat thumbnail -->\n                </div>\n            </div>\n        </div>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-primary" id="insert-btn">插入</button>\n        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>\n      </div>\n    </div>\n  </div>\n</div>',
0===$("#blueimp-gallery").length&&(t='<div id="blueimp-gallery" class="blueimp-gallery blueimp-gallery-controls">\n    <div class="slides"></div>\n    <h3 class="title"></h3>\n    <a class="prev">‹</a>\n    <a class="next">›</a>\n    <a class="close">×</a>\n    <a class="play-pause"></a>\n    <ol class="indicator"></ol>\n</div>',$("body").append($(t))),[e,i]},e.prototype.images=[],e.prototype.render_images=function(){var t,e,i,n,r,o,s,a,l,u,d;for(u=[],l=this.images,r=0,s=l.length;s>r;r++)n=l[r],d='<div style="width:108px;height:150px;float:left;margin:5px;" class="image-item">\n    <div class="thumbnail">\n        <div class="preview">\n            <a title="'+n.name+'" href="'+n.url+'" data-gallery>\n                <img src="'+(n.url+"?imageView2/1/w/100/h/75")+'">\n            </a>\n        </div>\n        <div>\n            <h6 class="name">\n              <p class="dm-text-ellipsis">'+n.name+'</p>\n            </h6>\n            <button type="button" class="btn btn-xs delete-btn" data-hash="'+n.hash+'" style="margin-left: 69px;">\n                <i class="glyphicon glyphicon-trash"></i>\n            </button>\n        </div>\n    </div>\n</div>',u.push(d);for(t=this.modal.find(".thumbnails"),t.empty(),o=0,a=u.length;a>o;o++)e=u[o],t.append($(e));return i=this.images,t.find(".delete-btn").click(function(){var t,e,r,o;for(o=[],t=r=0,e=i.length;e>r;t=++r)n=i[t],(null!=n?n.hash:void 0)===$(this).attr("data-hash")?(i.splice(t,1),o.push($(this).parents(".image-item").remove())):o.push(void 0);return o})},e.prototype.insert_images=function(){var t,e,i,n,r;for(t=[],r=this.images,i=0,n=r.length;n>i;i++)e=r[i],t.push('<img src="'+e.url+'" alt="'+e.name+'"></img>');return this.editor.setValue(this.editor.getValue()+t.join("")),this.editor.trigger("valuechanged"),this.modal.modal("hide")},e.prototype.command=function(){var t,e,i;return this.images=[],e=this.generate_template(),t=e[0],i=e[1],this.modal=$(i).prependTo("body"),this.progress_wrap=this.modal.find(".progress-wrap"),this.progress_bar=this.progress_wrap.find(".progress-bar"),this.modal.modal({backdrop:"static",keyboard:!1}),this.modal.on("shown.bs.modal",function(e){return function(i){return e.init_uploader(t),e.modal.find("#insert-btn").click(function(){return e.insert_images()})}}(this)),this.modal.on("hidden.bs.modal",function(t){return function(e){var i;return null!=(i=t.modal)?i.remove():void 0}}(this))},e.prototype.init_uploader=function(t){return Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:t,uptoken:QINIU_UPLOAD_TOKEN,save_key:!0,domain:QINIU_URL,filters:{mime_types:[{title:"Image files",extensions:"jpg,jpeg,gif,png"}],max_file_size:"4mb",prevent_duplicates:!0},max_file_size:"4mb",flash_swf_url:"/site_media/static/store/common/jquery-plugins/Moxie.swf",max_retries:2,dragdrop:!0,drop_element:"container",chunk_size:"4mb",auto_start:!0,init:{FilesAdded:function(t){return function(e,i){return plupload.each(i,function(t){}),t.progress_active=!0,setTimeout(function(){return t.progress_active?t.progress_wrap.show():void 0},500)}}(this),BeforeUpload:function(t,e){},UploadProgress:function(t){return function(e,i){var n;return n=e.total.percent,t.progress_bar.css("width",n+"%")}}(this),FileUploaded:function(t){return function(e,i,n){var r,o,s;return s=JSON.parse(n),t.images.push(s),t.render_images(),o={objects:[s]},r=document.getElementsByName("csrfmiddlewaretoken")[0].value,$.ajax({type:"POST",url:"/store/set_qiniu_image/",contentType:"application/json",data:JSON.stringify(o),beforeSend:function(t,e){return t.setRequestHeader("X-CSRFToken",r)},success:function(t){}})}}(this),Error:function(t,e,i){return alert(i)},UploadComplete:function(t){return function(){var e;return e=0,t.progress_active=!1,t.progress_wrap.hide()}}(this)}})},e}(r),N.Toolbar.addButton(A),L=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.name="video",e.prototype.icon="video",e.prototype.title="插入视频",e.prototype.needFocus=!1,e.prototype.generate_template=function(){var t,e;return t=Math.random().toString().substr(2,10),e='<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">\n  <div class="modal-dialog" style="width:655px">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n            <span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title">插入视频</h4>\n      </div>\n      <div class="modal-body">\n        <div class="row">\n            <div class="form-group col-xs-12">\n                <div class="col-xs-12">\n                    <input class="form-control input-video" type="text" placeholder="请直接输入优酷、土豆、腾讯视频的视频链接">\n                </div>\n            </div>\n            <div class="form-group col-xs-12">\n                <div class="form-group col-xs-6">\n                    <label for="width">视频宽度</label>\n                    <input class="form-control input-width" type="text" placeholder="视频宽度" value="100%">\n                </div>\n                <div class="form-group col-xs-6">\n                    <label for="height">视频高度</label>\n                    <input class="form-control input-height" type="text" placeholder="视频高度" value="400px">\n                </div>\n                <p class="col-xs-12 help-block">提示：高度宽度既可以使用绝对像素如<code>400px</code>，也可以使用相对宽度，如<code>100%</code>。</p>\n            </div>\n        </div>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-primary btn-insert">插入</button>\n        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>\n      </div>\n    </div>\n  </div>\n</div>',[t,e]},e.prototype.command=function(){var t,e,i;return e=this.generate_template(),t=e[0],i=e[1],this.modal=$(i).prependTo("body"),this.input_video=this.modal.find(".input-video"),this.btn_insert=this.modal.find(".btn-insert"),this.input_width=this.modal.find(".input-width"),this.input_height=this.modal.find(".input-height"),this.modal.modal("show"),this.modal.on("shown.bs.modal",function(t){return function(e){return t.input_video.focus(),t.input_video.keypress(function(e){return 13===(e.keyCode||e.which)?t.insert_video():void 0}),t.btn_insert.click(function(){return t.insert_video()})}}(this)),this.modal.on("hidden.bs.modal",function(t){return function(e){var i;return null!=(i=t.modal)?i.remove():void 0}}(this))},e.prototype.insert_video=function(){var t;return t=this.input_video.val(),t.match(/(\.tudou\.com\/|\.youku\.com\/|v\.qq\.com\/)/i)?$.get("/store/get_video_info/",{url:t}).done(function(t){return function(e){var i,n,r,o;return e.iframe_src?(r=e.iframe_src,o=t.input_width.val()||"100%",i=t.input_height.val()||"400px",n='<p>\n<iframe src="'+r+'" allowtransparency="true" allowfullscreen="true"\n    allowfullscreenInteractive="true" frameborder="0"\n    width="'+o+'" height="'+i+'" style="display:block"></iframe>\n</p>',t.editor.setValue(t.editor.getValue()+n),t.editor.trigger("valuechanged"),t.modal.modal("hide")):void 0}}(this)):alert("只能插入优酷土豆和腾讯视频")},e}(r),N.Toolbar.addButton(L),K=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return q(e,t),e.prototype.name="word",e.prototype.icon="word",e.prototype.title="上传Word文档",e.prototype.needFocus=!1,e.prototype.generate_template=function(){var t,e;return t=Math.random().toString().substr(2,10),e='<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">\n  <div class="modal-dialog" style="width:655px">\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n            <span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title">导入 Word 文档</h4>\n      </div>\n      <div class="modal-body">\n        <div class="row">\n            <div class="form-group col-xs-12">\n                <div class="col-xs-12">\n                    <div class="col-xs-4 col-xs-push-4" style="padding-left:5px;">\n                        <a class="btn btn-success" id="'+t+'" style="width:160px;">\n                            <i class="glyphicon glyphicon-plus"></i>上传 Word 文档\n                        </a>\n                    </div>\n                </div>\n                <div class="col-xs-12">\n                    <p class="help-block center-block" style="text-align: center;margin-top: 20px;">\n                        可以上传 .docx .doc 和 .wps 文档(小于10M)</p>\n                    <p class="help-block center-block" style="text-align: center;">\n                        强烈建议使用 .docx 格式，导入速度快 5 倍以上</p>\n                </div>\n            </div>\n            <div class="form-group col-xs-12">\n                <div class="col-xs-12 progress-wrap" style="display:none">\n                    <div class="progress progress-striped active">\n                        <div class="progress-bar progress-bar-success" style="width:5%"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>\n      </div>\n    </div>\n  </div>\n</div>',[t,e]},e.prototype.command=function(){var t,e,i;return e=this.generate_template(),t=e[0],i=e[1],this.modal=$(i).prependTo("body"),this.progress_wrap=this.modal.find(".progress-wrap"),this.progress_bar=this.progress_wrap.find(".progress-bar"),this.modal.modal({backdrop:"static",keyboard:!1}),this.modal.on("shown.bs.modal",function(e){return function(i){return e.init_uploader(t)}}(this)),this.modal.on("hidden.bs.modal",function(t){return function(e){var i;return null!=(i=t.modal)?i.remove():void 0}}(this))},e.prototype.init_uploader=function(t){var e,i;return e=document.getElementsByName("csrfmiddlewaretoken")[0].value,i=new plupload.Uploader({browse_button:t,url:"/store/docx_to_html/",runtimes:"html5,flash,html4",flash_swf_url:"/site_media/static/store/common/jquery-plugins/Moxie.swf",multipart_params:{csrfmiddlewaretoken:e},filters:{max_file_size:"10mb",prevent_duplicates:!0}}),i.init(),i.bind("FilesAdded",function(t){return function(e,n){return n[0].name.match(/\.(doc|docx|wps)$/)?(t.progress_width=0,i.start()):(e.splice(),alert("只能上传 .docx .doc 和 .wps 后缀的文档。"))}}(this)),i.bind("UploadProgress",function(t){return function(e,i){var n,r;return n=e.total.percent,t.progress_wrap.show(),(r=function(){return t.progress_width+=5,t.progress_width>=100?void 0:(t.progress_bar.css("width",t.progress_width+"%"),setTimeout(r,500))})()}}(this)),i.bind("FileUploaded",function(t){return function(e,i,n){var r;return r=n.response,t.editor.setValue(t.editor.getValue()+r),t.editor.trigger("valuechanged"),t.modal.modal("hide")}}(this)),i.bind("Error",function(t,e){return this.progress_wrap.hide(),this.progress_bar.css("width","5%"),alert("出现错误，请重试。("+e.message+")")}),i.bind("UploadComplete",function(t,e){})},e}(r),N.Toolbar.addButton(K),window.Simditor=N}(),function(){return angular.module("dm.simditor",[]).directive("simditor",function(){return{restrict:"A",require:"ngModel",scope:{config:"=?",toolbar:"@"},link:function(t,e,i,n){var r,o,s;return s={all:["title","bold","italic","underline","strikethrough","color","|","ol","ul","blockquote","code","table","|","link","hr","|","indent","outdent","alignment","|","html","background"],simple:["title","bold","italic","underline","strikethrough","color","ol","ul","hr","table"]},r={textarea:e,placeholder:i.placeholder||"",pasteImage:!0,toolbar:t.toolbar?s[t.toolbar]:s.all,allowedTags:["br","a","img","b","strong","i","u","font","p","ul","ol","li","blockquote","pre","h1","h2","h3","h4","hr","div"],allowedAttributes:{img:["src","alt","width","height","data-image-src","data-image-size","data-image-name","data-non-image"],a:["href","target"],font:["color"],pre:["data-lang"],code:["class"],p:["data-indent","data-align"],h1:["data-indent"],h2:["data-indent"],h3:["data-indent"],h4:["data-indent"]}},t.config=angular.extend(r,t.config),o=new Simditor(t.config),o.on("valuechanged",function(t,e){return n.$setViewValue(o.getValue())}),t.$watch(function(){return n.$modelValue},function(t){return t&&!n.$dirty?o.setValue(n.$modelValue):void 0})}}})}();